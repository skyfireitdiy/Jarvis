{
  "problem_type": "规则库分离重构",
  "content": "问题重述：\n在代码重构项目中，需要将大型模块中的规则库（如正则表达式规则）与检查逻辑分离，以提高代码的可维护性和可测试性。这种重构通常涉及将大量的规则定义从主逻辑文件中提取到独立的模块中，并按功能进行分类组织。\n\n可复用解决流程：\n1. 分析阶段：\n   - 识别规则库位置和内容（如正则表达式规则）\n   - 统计规则数量和类别\n   - 分析规则与逻辑的耦合点\n   - 制定按功能分类的方案\n\n2. 设计阶段（SDD流程）：\n   - 编写详细的Spec文档，包含功能概述、接口定义、模块拆分设计、验收标准等\n   - 设计规则库模块结构，按功能类别组织规则类\n   - 定义规则访问接口\n   - 规划迁移路径\n\n3. 测试准备阶段（TDD流程）：\n   - 编写测试用例覆盖所有规则，验证规则的正确性\n   - 确保每个规则都有对应的测试验证其匹配能力\n   - 运行现有测试套件确保功能完整性\n\n4. 实现阶段：\n   - 创建独立的规则库模块文件\n   - 按设计好的类别将规则组织为类属性\n   - 保持原有规则的编译选项不变\n   - 修改主模块导入语句，引用新的规则库\n\n5. 规则引用替换阶段：\n   - 逐步将原规则引用替换为新规则库的引用\n   - 保持原有功能行为不变\n   - 采用小步快跑的方式，每次替换后验证功能\n\n6. 验证阶段：\n   - 运行所有测试套件确保功能一致性\n   - 验证重构后输出与原版本一致\n   - 检查代码行数是否符合预期（如<1000行）\n   - 验证规则库可独立扩展\n\n注意事项：\n- 保持原有功能行为不变，确保所有测试通过\n- 规则库分离后应支持独立扩展和维护\n- 遵循TDD流程，先写测试再实现重构\n- 采用SDD流程，基于Spec文档进行重构\n- 小步快跑，每次改动后立即验证\n\n可选步骤：\n- 如果主模块代码行数仍超标，可进一步提取逻辑到其他辅助模块\n- 优化测试覆盖率，确保规则库和主逻辑都有充分的测试覆盖\n- 评估是否需要进一步重构主模块以达到代码行数目标",
  "scope": "project"
}
