{
  "problem_type": "Python模块开发",
  "content": "# Python模块开发方法论\n\n## 规则简介\n\n本方法论定义了在Jarvis项目中开发Python模块的标准流程，包括目录结构、核心功能实现、测试编写和质量保证的完整流程。\n\n## 你必须遵守的原则\n\n### 模块化设计原则\n\n**要求说明：**\n\n- **必须**：将功能拆分为独立的模块，降低复杂度\n- **必须**：每个模块有清晰的职责边界\n- **必须**：使用类型注解\n- **必须**：添加完善的文档字符串\n\n### 轻量级原则\n\n**要求说明：**\n\n- **必须**：优先使用Python标准库\n- **禁止**：引入不必要的重依赖\n- **必须**：评估每个依赖的必要性\n\n### 质量保证原则\n\n**要求说明：**\n\n- **必须**：测试覆盖率 ≥ 80%\n- **必须**：ruff 检查通过\n- **必须**：mypy 类型检查通过\n- **必须**：bandit 安全检查通过\n\n## 你必须执行的操作\n\n### 阶段1：准备阶段\n\n1. **创建目录结构**：\n   - 模块目录：`src/jarvis/模块名/`\n   - 测试目录：`tests/模块名/`\n   - 创建 `__init__.py` 文件\n\n2. **设计核心功能**：\n   - 定义数据类（dataclass）或枚举\n   - 设计主要类和方法\n   - 明确输入输出接口\n\n### 阶段2：实现阶段\n\n1. **实现核心模块**：\n   - 按功能拆分文件（如 manager.py, reporter.py, history.py）\n   - 使用标准库优先（如 tomllib、urllib）\n   - 使用项目已有依赖（如 packaging）\n\n2. **实现辅助功能**：\n   - 报告生成\n   - 历史记录\n   - 缓存机制\n\n3. **安全编码**：\n   - 使用 `tempfile.gettempdir()` 获取临时目录\n   - 避免硬编码路径\n   - 对 urllib.urlopen 使用 # nosec B310 标记并说明原因\n\n### 阶段3：测试阶段\n\n1. **编写测试用例**：\n   - 测试数据类/枚举\n   - 测试核心功能\n   - 测试辅助功能\n   - 使用 Mock 避免网络/文件系统依赖\n\n2. **验证测试覆盖**：\n   - 运行 `pytest --cov` 确保覆盖率 ≥ 80%\n   - 检查未覆盖的代码路径\n\n### 阶段4：质量检查阶段\n\n1. **运行代码检查工具**：\n   ```bash\n   ruff check 模块目录/ tests/模块目录/\n   mypy 模块目录/\n   bandit -r 模块目录/\n   pytest tests/模块目录/ -v --cov=模块目录 --cov-report=term-missing\n   ```\n\n2. **修复所有问题**：\n   - ruff 错误：修复未使用导入、格式问题\n   - mypy 错误：添加缺失的类型注解\n   - bandit 错误：\n     - B108：使用 `tempfile.gettempdir()` 替代硬编码路径\n     - B310：在 urllib.urlopen 行尾添加 `# nosec B310` 并注释说明\n\n## 实践指导\n\n### 最佳实践\n\n1. **渐进式开发**：先实现核心功能，再逐步完善\n2. **测试驱动**：编写测试用例验证功能正确性\n3. **安全编码**：遵循bandit安全规范\n4. **代码风格**：使用类型注解和文档字符串\n\n### 常见错误\n\n1. **过度依赖**：引入不必要的第三方库\n2. **硬编码路径**：直接使用 `/tmp` 等路径\n3. **缺少测试**：未达到80%覆盖率要求\n4. **类型注解缺失**：mypy 检查失败\n\n## 检查清单\n\n- [ ] 目录结构完整（模块目录 + 测试目录）\n- [ ] __init__.py 文件已创建\n- [ ] 核心功能已实现\n- [ ] 使用标准库优先\n- [ ] 类型注解完整\n- [ ] 文档字符串完善\n- [ ] 测试用例覆盖所有功能\n- [ ] 测试覆盖率 ≥ 80%\n- [ ] ruff 检查通过\n- [ ] mypy 检查通过\n- [ ] bandit 检查通过\n- [ ] 无硬编码路径\n- [ ] 无不必要依赖",
  "scope": "project"
}