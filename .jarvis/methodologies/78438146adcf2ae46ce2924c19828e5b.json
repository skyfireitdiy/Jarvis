{
  "problem_type": "功能模块开发",
  "content": "# 功能模块开发方法论\n\n## 规则简介\n\n本方法论定义了在 Jarvis 项目中开发新功能模块的标准流程，确保模块设计合理、代码质量高、测试覆盖充分。适用于自我修复机制、监控告警等各类功能模块的开发。\n\n## 你必须遵守的原则\n\n### 轻量级原则\n\n**要求说明：**\n\n- **必须**：优先使用 Python 标准库，避免重依赖\n- **必须**：模块功能聚焦单一职责\n- **禁止**：引入大型第三方库（除非绝对必要）\n\n### 质量保证原则\n\n**要求说明：**\n\n- **必须**：所有模块必须有配套测试，覆盖率≥80%\n- **必须**：通过 ruff 代码风格检查\n- **必须**：通过 mypy 类型检查\n- **必须**：遵循项目编码规范\n\n### 安全原则\n\n**要求说明：**\n\n- **必须**：禁止自动修改用户配置或代码\n- **必须**：仅提供建议或检测功能\n- **禁止**：使用破坏性操作\n\n### 可维护性原则\n\n**要求说明：**\n\n- **必须**：使用类型注解\n- **必须**：添加完善的文档字符串\n- **必须**：保持代码结构清晰，遵循已有模块风格\n\n## 你必须执行的操作\n\n### 阶段1：需求分析\n\n1. **理解需求**：明确功能目标、边界和验收标准\n2. **识别约束**：确认技术栈、性能要求、安全要求\n3. **分析依赖**：识别模块间的依赖关系\n\n### 阶段2：架构设计\n\n1. **设计模块结构**：规划文件组织（__init__.py、核心模块、工具模块等）\n2. **定义接口**：设计类和函数接口，包括参数和返回值\n3. **数据结构设计**：使用 dataclass 定义数据结构\n4. **规划测试**：设计测试用例覆盖核心功能\n\n### 阶段3：核心实现\n\n1. **创建目录结构**：创建 src/jarvis/模块名/ 和 tests/模块名/\n2. **实现核心类**：实现主要功能类\n3. **实现数据类**：使用 dataclass 定义数据结构\n4. **创建模块入口**：编写 __init__.py 导出核心类\n\n### 阶段4：测试开发\n\n1. **编写测试用例**：覆盖所有核心功能和边界条件\n2. **使用 fixture**：创建测试数据 fixture\n3. **验证功能**：确保所有测试通过\n4. **检查覆盖率**：确保覆盖率≥80%\n\n### 阶段5：质量验证\n\n1. **运行 ruff 检查**：确保代码风格符合规范\n2. **运行 mypy 检查**：确保类型安全\n3. **运行 pytest**：确保所有测试通过\n4. **验证功能**：手动验证核心功能满足需求\n\n## 实践指导\n\n### 模块结构建议\n\nsrc/jarvis/jarvis_module_name/\n├── __init__.py           # 模块入口\n├── analyzer.py           # 分析器（如需分析功能）\n├── optimizer.py          # 优化器（如需优化功能）\n└── history.py            # 历史记录（如需记录功能）\n\ntests/jarvis_module_name/\n├── __init__.py           # 测试模块入口\n└── test_module_name.py   # 测试用例\n\n### 数据结构设计\n\n使用 dataclass 定义清晰的数据结构：\n\nfrom dataclasses import dataclass\n\n@dataclass\nclass Result:\n    \"\"\"分析结果.\"\"\"\n    timestamp: datetime\n    total_issues: int\n    issues: list[Issue]\n\n### 测试 fixture 使用\n\n使用 pytest fixture 创建可复用的测试数据：\n\n@pytest.fixture\ndef sample_data():\n    \"\"\"创建测试数据.\"\"\"\n    return \"test data\"\n\n## 检查清单\n\n- [ ] 需求分析完成，明确功能和边界\n- [ ] 架构设计完成，定义接口和数据结构\n- [ ] 核心实现完成，代码清晰易读\n- [ ] 测试用例编写完成，覆盖核心功能\n- [ ] 测试覆盖率≥80%\n- [ ] ruff 检查通过，无错误\n- [ ] mypy 类型检查通过，无错误\n- [ ] 所有 pytest 测试通过\n- [ ] 文档字符串完善\n- [ ] 类型注解完整",
  "scope": "project"
}