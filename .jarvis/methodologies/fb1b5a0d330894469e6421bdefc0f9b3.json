{
  "problem_type": "在Agent提示词中添加工具使用指南",
  "content": "## 问题描述\n\n当需要在 Agent 的系统提示词中添加某个工具的使用指南时，如何标准地实现该功能。\n\n## 可复用解决流程\n\n### 步骤 1：定位修改位置\n找到 `src/jarvis/jarvis_agent/prompt_manager.py` 文件中的 `build_system_prompt` 方法。\n\n### 步骤 2：添加工具检查逻辑\n在 `action_prompt` 获取之后，添加工具可用性检查代码：\n```python\n# 检查 [tool_name] 工具是否可用\n[tool_name]_guide = \"\"\ntool_registry = self.agent.get_tool_registry()\nif isinstance(tool_registry, ToolRegistry):\n    [tool_name]_tool = tool_registry.get_tool(\"[tool_name]\")\n    if [tool_name]_tool:\n        [tool_name]_guide = \\\"\\\"\\\"\n\n<[tool_name]_guide>\n# [工具名称]使用指南\n\n[指南内容]\n</[tool_name]_guide>\n\\\"\\\"\\\"\n```\n\n### 步骤 3：编写指南内容\n指南内容应包含以下部分：\n- **适用场景**：说明何时需要使用该工具\n- **工具介绍**：工具名称、功能、参数说明\n- **支持的变量/选项**（如适用）：列出可用的内置变量或配置选项\n- **使用建议**：最佳实践和注意事项\n- **示例**：提供完整的使用示例（JSON 格式）\n\n### 步骤 4：整合到提示词\n在 `return f\\\"\\\"\\\"...\\\"\\\"\\\"` 语句中，将 `[tool_name]_guide` 插入到合适的位置：\n- 推荐位置：在 `task_list_manager_note` 之后，`system_tools_info` 之前\n- 格式：`{[tool_name]_guide}`\n\n## 注意事项\n\n1. **风格一致性**：指南内容风格应与 `task_list_manager_guide` 保持一致\n2. **条件显示**：只在工具可用时才显示指南，避免工具不存在时出现冗余信息\n3. **代码复用**：复用 `tool_registry` 变量，避免重复获取\n4. **Markdown 格式**：指南内容使用 Markdown 格式，确保可读性\n5. **JSON 示例**：提供完整的 JSON 调用示例，方便参考\n\n## 可选步骤\n\n如果指南内容较长，可以考虑：\n- 将指南内容提取到单独的常量字符串中\n- 创建单独的辅助方法来生成指南内容\n\n## 参考示例\n\n查看 `src/jarvis/jarvis_agent/prompt_manager.py` 中的 `task_list_manager_note` 和 `load_rule_guide` 实现作为参考。",
  "scope": "project"
}
