{
  "problem_type": "CodeAgent静态检查告警处理",
  "content": "# CodeAgent静态检查告警处理方法论\n\n## 规则简介\n\n本方法论用于指导CodeAgent在静态检查发现告警时的处理流程，优先使用自动化工具修复，提高代码质量和修复效率。\n\n## 你必须遵守的原则\n\n### 原则1：优先使用自动修复工具\n\n**要求说明：**\n\n- **必须**：在发现静态检查告警时，首先检查是否存在可用的自动修复工具\n- **必须**：向用户明确展示可用的自动修复命令建议\n- **必须**：使用安全的路径处理方式（如shlex.quote）防止命令注入\n- **禁止**：直接让AI修改代码而不提示自动修复选项\n- **禁止**：构造不安全的shell命令字符串\n\n### 原则2：分级处理告警\n\n**要求说明：**\n\n- **必须**：区分不同严重程度的告警（错误、警告、建议）\n- **必须**：优先处理影响功能的错误告警\n- **建议**：对于代码风格类告警，优先使用格式化工具自动修复\n\n### 原则3：保持可扩展性\n\n**要求说明：**\n\n- **必须**：使用映射表（字典）管理lint工具与自动修复命令的对应关系\n- **必须**：支持通过配置文件扩展新的工具支持\n- **禁止**：将工具配置硬编码在业务逻辑中\n\n## 你必须执行的操作\n\n### 阶段1：告警分析\n\n1. **收集告警信息**：执行静态检查工具，收集所有告警信息\n2. **提取工具名称**：从lint命令中提取工具名称（命令的第一个单词）\n3. **分类告警**：按文件和工具对告警进行分组\n\n### 阶段2：生成修复建议\n\n1. **查找自动修复命令**：在LINT_AUTO_FIX_COMMANDS映射表中查找工具对应的自动修复命令\n2. **替换占位符**：将命令模板中的{file_path}替换为实际文件路径\n3. **安全转义**：使用shlex.quote对文件路径进行转义\n4. **去重处理**：避免对同一文件重复生成相同的修复命令\n\n### 阶段3：展示建议\n\n1. **优先显示自动修复建议**：如果存在可用的自动修复工具，优先显示\n2. **显示完整告警信息**：展示静态检查的详细输出\n3. **提供备选方案**：提示用户自动修复工具无法解决时再手动修复\n\n## 实践指导\n\n### 常见lint工具的自动修复命令\n\n| 工具 | 检查命令 | 自动修复命令 |\n|------|---------|-------------|\n| ruff | ruff check {file} | ruff check --fix {file} |\n| eslint | eslint {file} | eslint --fix {file} |\n| cargo clippy | cargo clippy | cargo clippy --fix --allow-dirty |\n| go vet | go vet {file} | go fmt {file}, goimports -w {file} |\n| clang-tidy | clang-tidy {file} | clang-tidy --fix {file} |\n\n### 扩展新的自动修复工具\n\n在`src/jarvis/jarvis_code_agent/lint.py`的`LINT_AUTO_FIX_COMMANDS`中添加映射：\n\n```python\n\"新工具名\": [\"新工具 --fix {file_path}\"]\n```\n\n### 安全注意事项\n\n- 始终使用shlex.quote处理文件路径\n- import语句放在文件顶部，不要在函数内部import\n- 访问split()结果前检查列表是否为空\n\n## 检查清单\n\n- [ ] 是否检查了所有lint工具的自动修复能力\n- [ ] 是否使用了shlex.quote进行路径转义\n- [ ] 是否优先展示了自动修复建议\n- [ ] 自动修复命令是否经过安全验证\n- [ ] 是否支持通过配置扩展新工具",
  "scope": "project"
}
