{
  "id": "20260131_193736_047050",
  "type": "project_long_term",
  "tags": [
    "记忆系统",
    "memory",
    "save_memory",
    "retrieve_memory",
    "架构分析",
    "阶段2",
    "知识自主积累"
  ],
  "content": "## 记忆系统架构分析报告\n\n### 1. 系统架构概览\n\n```\n┌─────────────────────────────────────────────────────────┐\n│                    记忆系统架构                          │\n├─────────────────────────────────────────────────────────┤\n│  工具层                                                  │\n│  ├── SaveMemoryTool (jarvis_tools/save_memory.py)       │\n│  │   └── 保存记忆到文件或内存                            │\n│  ├── RetrieveMemoryTool (jarvis_tools/retrieve_memory.py)│\n│  │   └── 检索记忆，支持标签过滤                          │\n│  └── ClearMemoryTool (jarvis_tools/clear_memory.py)     │\n│      └── 清除指定记忆                                    │\n├─────────────────────────────────────────────────────────┤\n│  存储层                                                  │\n│  ├── 项目长期记忆: .jarvis/memory/*.json                │\n│  ├── 全局长期记忆: ~/.jarvis/memory/global_long_term/   │\n│  └── 短期记忆: 内存中（globals.py）                      │\n├─────────────────────────────────────────────────────────┤\n│  整理层                                                  │\n│  └── MemoryOrganizer (jarvis_memory_organizer/)         │\n│      └── 合并相似标签的记忆，导入导出                     │\n└─────────────────────────────────────────────────────────┘\n```\n\n### 2. 记忆JSON结构\n\n```json\n{\n  \"id\": \"20250802_121422_812796\",\n  \"type\": \"project_long_term\",\n  \"tags\": [\"标签1\", \"标签2\"],\n  \"content\": \"记忆内容\",\n  \"created_at\": \"2025-08-02T12:14:22.812837\",\n  \"updated_at\": \"2025-08-02T12:14:22.812842\"\n}\n```\n\n**ID生成规则**：`YYYYMMDD_HHMMSS_ffffff`（时间戳+微秒）\n\n### 3. 记忆类型对比\n\n| 特性 | 短期记忆 | 项目长期记忆 | 全局长期记忆 |\n|------|----------|--------------|--------------|\n| 存储位置 | 内存（globals.py） | .jarvis/memory/ | ~/.jarvis/memory/global_long_term/ |\n| 持久化 | 否（会话结束丢失） | 是 | 是 |\n| 作用域 | 当前会话 | 当前项目 | 所有项目 |\n| 最大数量 | 100条 | 无限制 | 无限制 |\n| 检索方式 | 标签过滤 | 标签过滤 | 标签过滤 |\n\n### 4. 核心接口\n\n**SaveMemoryTool.execute(args)**：\n- memories: 记忆列表，每条包含 memory_type, tags, content\n- 返回: {success, stdout, stderr}\n\n**RetrieveMemoryTool.execute(args)**：\n- memory_types: 要检索的类型列表\n- tags: 标签过滤（可选）\n- limit: 返回数量限制（可选）\n- 返回: Markdown格式的检索结果\n\n**MemoryOrganizer方法**：\n- `organize_memories(memory_type, dry_run)`: 合并相似记忆\n- `export_memories(memory_types, output_file, tags)`: 导出记忆\n- `import_memories(input_file, overwrite)`: 导入记忆\n\n### 5. 检索机制\n\n1. **标签匹配**：任意标签匹配即返回（OR逻辑）\n2. **时间排序**：按创建时间倒序（最新在前）\n3. **Token限制**：基于剩余token数量或输入窗口的2/3\n4. **数量限制**：最多返回50条\n\n### 6. 记忆整理机制\n\n1. **重叠检测**：查找具有≥2个相同标签的记忆组\n2. **LLM合并**：使用大模型将相似记忆合并成一条\n3. **优先级**：最近的记忆权重更高\n4. **自动清理**：合并后删除原始记忆文件\n\n### 7. 可扩展点\n\n1. **智能检索**：当前只有标签匹配，可增强语义检索\n2. **相关性排序**：当前只按时间排序，可增加相关性排序\n3. **记忆压缩**：当前只有合并，可增加自动摘要\n4. **记忆关联**：当前记忆之间无关联关系\n5. **记忆版本**：当前无版本控制\n6. **记忆质量评估**：当前无质量评估机制\n\n### 8. 与方法论/规则系统对比\n\n| 特性 | 记忆系统 | 方法论系统 | 规则系统 |\n|------|----------|------------|----------|\n| 存储格式 | JSON | JSON | Markdown |\n| 检索方式 | 标签过滤 | LLM选择 | 名称/前缀 |\n| 操作类型 | save/retrieve/clear | add/update/delete | load |\n| 整理功能 | 有（合并） | 无 | 无 |\n| 模板支持 | 无 | 无 | jinja2 |\n\n### 9. 后续开发建议\n\n1. **智能检索增强**：创建`smart_retrieval.py`模块\n   - 语义相似度匹配\n   - 相关性排序\n   - 上下文感知检索\n\n2. **集成方式**：\n   - 增强现有RetrieveMemoryTool\n   - 添加语义检索选项\n   - 保持向后兼容\n\n3. **质量评估**：\n   - 记忆完整性检查\n   - 记忆时效性评估\n   - 记忆重复性检测",
  "created_at": "2026-01-31T19:37:36.047069",
  "updated_at": "2026-01-31T19:37:36.047073"
}
