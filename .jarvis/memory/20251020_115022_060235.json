{
  "id": "20251020_115022_060235",
  "type": "project_long_term",
  "tags": [
    "jarvis_book",
    "core_concepts_architecture",
    "docs",
    "task_planner",
    "planner",
    "3.核心概念与架构.md",
    "headings",
    "insertion_points",
    "plantuml"
  ],
  "content": "{\n  \"file_path\": \"docs/jarvis_book/3.核心概念与架构.md\",\n  \"line_count\": 614,\n  \"headings\": [\n    {\"level\": 1, \"title\": \"3. 核心概念与系统架构\", \"line\": 1},\n    {\"level\": 2, \"title\": \"3.1 核心概念\", \"line\": 5},\n    {\"level\": 3, \"title\": \"3.1.1 代理 (Agent)\", \"line\": 9},\n    {\"level\": 3, \"title\": \"3.1.2 工具与工具注册表 (Tool & ToolRegistry)\", \"line\": 15},\n    {\"level\": 3, \"title\": \"3.1.3 平台与平台注册表 (Platform & PlatformRegistry)\", \"line\": 24},\n    {\"level\": 3, \"title\": \"3.1.4 模型 (Model)\", \"line\": 30},\n    {\"level\": 3, \"title\": \"3.1.5 方法论与中心方法论库\", \"line\": 36},\n    {\"level\": 3, \"title\": \"3.1.6 记忆系统 (Memory System)\", \"line\": 42},\n    {\"level\": 2, \"title\": \"3.2 系统架构\", \"line\": 62},\n    {\"level\": 3, \"title\": \"3.2.1 架构关系图\", \"line\": 66},\n    {\"level\": 4, \"title\": \"角色职责\", \"line\": 181},\n    {\"level\": 3, \"title\": \"3.2.2 核心架构原则\", \"line\": 251},\n    {\"level\": 3, \"title\": \"3.2.3 端到端工作流：一次工具调用的生命周期\", \"line\": 265},\n    {\"level\": 2, \"title\": \"3.3 核心组件详解\", \"line\": 281},\n    {\"level\": 3, \"title\": \"3.3.1 Jarvis Agent\", \"line\": 283},\n    {\"level\": 4, \"title\": \"主要职责\", \"line\": 287},\n    {\"level\": 4, \"title\": \"关联组件与内部模块\", \"line\": 297},\n    {\"level\": 4, \"title\": \"初始化流程\", \"line\": 307},\n    {\"level\": 4, \"title\": \"主运行循环 (AgentRunLoop)\", \"line\": 341},\n    {\"level\": 3, \"title\": \"3.3.2 工具注册表 (Tool Registry) 详解\", \"line\": 376},\n    {\"level\": 3, \"title\": \"3.3.3 平台注册表 (Platform Registry) 详解\", \"line\": 431},\n    {\"level\": 3, \"title\": \"3.3.4 记忆系统概览\", \"line\": 448},\n    {\"level\": 3, \"title\": \"3.3.5 任务分析方法论 (Task Analysis Methodology)\", \"line\": 461},\n    {\"level\": 3, \"title\": \"3.3.6 文件和方法论管理 (File & Methodology Management)\", \"line\": 484},\n    {\"level\": 3, \"title\": \"3.3.7 执行流程时序图\", \"line\": 505},\n    {\"level\": 4, \"title\": \"初始化阶段 (Initialization Phase)\", \"line\": 509},\n    {\"level\": 4, \"title\": \"任务执行阶段 (Task Execution Phase)\", \"line\": 558}\n  ],\n  \"plantuml_blocks\": [\n    {\"section\": \"系统架构关系图\", \"start_line\": 71, \"end_line\": 179, \"note\": \"需要在图中加入 Planner/TaskPlanner 组件及与 Agent/ToolRegistry/SubAgent 的交互\"}\n  ],\n  \"planner_mentions\": {\n    \"exists\": false,\n    \"note\": \"当前章节未出现 Planner/TaskPlanner 相关描述，需要新增\"\n  },\n  \"suggested_insertions\": [\n    {\n      \"type\": \"core_concept\",\n      \"title\": \"3.1.7 任务规划器（Planner / TaskPlanner）\",\n      \"insert_before_line\": 62,\n      \"outline\": [\n        \"定义：将用户高层目标分解为可执行子任务的规划组件\",\n        \"职责：任务分解、依赖/顺序安排、为 Agent/子Agent 生成执行计划\",\n        \"输入/输出：输入用户任务与上下文，输出结构化计划（含子任务、顺序、并行性、终止条件）\",\n        \"交互：与 Agent 协同执行；可调用 sub_agent/sub_code_agent；可访问方法论与记忆增强规划质量\",\n        \"配置/CLI：JARVIS_PLAN_MAX_DEPTH；--plan/--no-plan 开关；默认深度 3\"\n      ]\n    },\n    {\n      \"type\": \"architecture_diagram_update\",\n      \"section\": \"3.2.1 架构关系图\",\n      \"lines_hint\": \"71-179\",\n      \"changes\": [\n        \"在“代理”节点内或相邻新增 [任务规划器] 或 [TaskPlanner]\",\n        \"添加 Agent --> 任务规划器 的使用关系\",\n        \"任务规划器 --> 工具注册表（可选，用于规划阶段动态评估工具能力）\",\n        \"任务规划器 --> 子Agent（sub_agent/sub_code_agent）调用关系（如通过 Agent 委托）\"\n      ]\n    },\n    {\n      \"type\": \"roles_responsibility\",\n      \"section\": \"角色职责\",\n      \"insert_after_line\": 200,\n      \"title\": \"任务规划器（TaskPlanner）\",\n      \"bullets\": [\n        \"根据任务与上下文生成分层计划，支持递归拆分与深度限制（JARVIS_PLAN_MAX_DEPTH）\",\n        \"与方法论/记忆系统结合，形成可复用的规划策略\",\n        \"在启用 --plan 时驱动子任务创建与调度，可委托 sub_agent/sub_code_agent 执行\",\n        \"提供计划的输入输出契约（结构化 JSON/YAML），供 Agent 消费\"\n      ]\n    },\n    {\n      \"type\": \"architecture_principles\",\n      \"section\": \"3.2.2 核心架构原则\",\n      \"insert_after_line\": 263,\n      \"bullets\": [\n        \"计划-执行分离（Planning-Execution Separation）：Planner 负责“如何拆分与安排”，Agent 负责“如何协调与执行”\"\n      ]\n    },\n    {\n      \"type\": \"workflow_update\",\n      \"section\": \"3.2.3 端到端工作流\",\n      \"insert_after_line\": 269,\n      \"bullets\": [\n        \"（可选）规划步骤：当启用 --plan 时，Agent 调用 TaskPlanner 生成计划，随后按计划驱动模型调用与工具执行；未启用时按原有直连模式执行\"\n      ]\n    },\n    {\n      \"type\": \"components_detail\",\n      \"section\": \"3.3 核心组件详解\",\n      \"insert_before_line\": 376,\n      \"title\": \"3.3.2 任务规划器（TaskPlanner）\",\n      \"outline\": [\n        \"位置：src/jarvis/jarvis_agent/task_planner.py\",\n        \"核心接口：plan(task, context, depth<=JARVIS_PLAN_MAX_DEPTH) -> Plan\",\n        \"计划结构：包含子任务、依赖、顺序/并行标识、终止条件、回退策略\",\n        \"与 Agent/Output Handler/ToolRegistry 的交互：作为旁路能力生成执行序列\",\n        \"与子Agent的关系：通过 sub_agent/sub_code_agent 承载子任务的执行\",\n        \"CLI 与配置：--plan/--no-plan；JARVIS_PLAN_MAX_DEPTH\"\n      ],\n      \"note\": \"后续章节序号需整体顺延（原3.3.2及后续小节编号+1）\"\n    }\n  ],\n  \"cross_refs\": [\n    {\"file\": \"docs/jarvis_book/9.附录.md\", \"keys\": [\"JARVIS_PLAN_MAX_DEPTH\"], \"cli\": [\"--plan\", \"--no-plan\"], \"status\": \"已存在于附录，需在本章引用与说明保持一致\"}\n  ]\n}\n",
  "created_at": "2025-10-20T11:50:22.060265",
  "updated_at": "2025-10-20T11:50:22.060269"
}