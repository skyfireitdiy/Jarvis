{
  "content": "Jarvis C2Rust 多Agent系统设计与测试驱动验证机制优化\n\n【C2Rust多Agent系统架构（2025-10-17）】\n\n【总体目标】\n在 /home/skyfire/code/Jarvis/builtin/multi_agent 设计\"C/C++ -> Rust\"转换多Agent系统，实现渐进式代码迁移与测试验证。\n\n【核心流程】\n1) 识别当前代码的构建框架与流程，产出一键编译脚本\n2) 识别/构建测试用例运行流程，产出测试脚本（若缺失则创建测试框架与空用例）\n3) 建立Rust静态库（staticlib）工程并与现有工程链接，产出运行测试用例脚本\n4) 逐步发现C/C++单元，补充用例并保证通过；随后以Rust实现替换，并在未转换依赖处使用extern/unsafe调用\n5) 用例通过后优化Rust实现，减少不必要的unsafe，保持用例通过\n6) 迭代直到全量切换到Rust\n\n【设计要求】\n- 除主Agent外尽量无状态或使用Sub Agent\n- 支持断点续转：通过关键文件（如进度状态文件）识别转换进度\n- 遵循项目现有multi_agent风格（优先YAML编排），最小侵入、可回滚\n\n【预期产物与路径】\n- 编排：builtin/multi_agent/c2rust_migration.yaml（主编排）\n- 进度文件：builtin/multi_agent/c2rust_state.json（断点续转状态）\n- 脚本：scripts/build.sh、scripts/test.sh、scripts/run_tests_with_rust.sh\n- Rust桥接工程：rust_bridge/（Cargo.toml、build.rs、src/lib.rs，crate-type为staticlib）\n\n【测试驱动验证机制优化（2025-10-27）】\n\n【决策与约束】\n1) 将构建验证从 cargo build/check 切换为 cargo test（即使无测试也能编译并执行0测试），统一在Transpiler与Optimizer两处实现\n2) 在Transpiler的代码生成流程中，新增最小Rust测试用例生成步骤：在目标模块文件内添加 #[cfg(test)] mod tests，参考C源码片段和函数签名生成可编译的占位测试（不使用panic!/todo!），并在每次修改后执行 cargo test 进行验证\n3) Optimizer中的所有 cargo check 调用与相关CodeAgent提示统一替换为 cargo test；自检与修复循环也改为以测试为准\n4) 保持最小变更：不大范围重构，仅替换命令与提示文案，并在Transpiler中新增一个确保测试存在的辅助方法并在生成实现后调用\n5) 提示文案与日志输出同步调整：从\"构建/检查\"改为\"测试/用例执行\"，确保一致性\n\n【实施细节】\n- Transpiler 测试生成：\n  * 在目标模块文件内添加 #[cfg(test)] mod tests\n  * 基于C源码片段和函数签名生成可编译的占位测试\n  * 避免使用 panic!/todo!/unimplemented! 等会导致测试失败的占位符\n  * 每次修改后执行 cargo test 进行验证\n\n- Optimizer 测试验证：\n  * 所有 cargo check 调用替换为 cargo test\n  * CodeAgent 提示文案更新为测试导向\n  * 自检与修复循环以测试执行结果为准\n\n【设计原则】\n- 测试驱动：以 cargo test 作为统一的验证标准\n- 渐进验证：每个转换步骤都通过测试确保正确性\n- 最小变更：保持现有架构稳定，仅优化验证机制\n- 一致性：Transpiler 与 Optimizer 使用相同的验证标准\n\n【预期效果】\n- 建立完整的C2Rust多Agent迁移框架\n- 实现测试驱动的代码转换与优化流程\n- 提高代码质量和转换可靠性\n- 确保每个步骤的可验证性与可回退性\n- 统一验证标准，减少验证逻辑的复杂性\n\n【系统集成】\n- 多Agent系统提供架构框架\n- 测试驱动机制确保转换质量\n- 断点续转支持长时间迁移任务\n- 最小变更策略保证系统稳定性",
  "tags": [
    "c2rust",
    "jarvis_multi_agent",
    "cargo_test",
    "tests",
    "transpiler",
    "optimizer",
    "test_driven",
    "migration_system",
    "verification_mechanism",
    "progressive_transformation",
    "quality_assurance"
  ],
  "type": "project_long_term",
  "merged_from": ["20251017_223816_053477", "20251027_105649_146284"],
  "id": "merged_81d338c2",
  "created_at": "2025-11-12T23:47:22.390256"
}
