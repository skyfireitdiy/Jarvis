{
  "content": "Jarvis C2Rust 渐进式迁移系统与 Oh-Sec 安全分析工作流设计\n\n【Jarvis C2Rust 渐进式迁移系统】\n\n【总体目标】\n在 src/jarvis 下创建 jarvis_c2rust 模块，采用\"workflow + agent\"模式实现 C/C++ -> Rust 渐进式迁移多智能体流程，支持中断后依赖仓库内文件状态断点续转，确保长流程LLM评估的可恢复性，最小侵入改造，通过文件状态管理实现进度追踪与恢复。\n\n【核心架构】\n采用\"workflow + agent\"模式，参考规范文件：builtin/multi_agent/c2rust_migration.yaml\n\n【关键状态文件与目录】\n位于目标工程根目录的结构化状态管理：\n- c2rust_migration/{00_project_info.md, 01_build_script.sh, 02_test_script.sh, 03_rust_bridge_initialized, 04_unit_queue.json, 05_progress.md, patches/, diagnostics/}\n- scripts/{build.sh, test.sh, run_tests_with_rust.sh}\n- rust_bridge/{Cargo.toml, src/lib.rs, ...}\n\n【迁移代理体系】\n- MigrationCoordinator：整体流程协调与状态管理\n- BuildSystemDetector：构建系统识别与适配\n- TestHarnessEngineer：测试框架生成与维护\n- RustBridgeEngineer：Rust桥接层设计与实现\n- UnitSelector：迁移单元选择与优先级排序\n- TestAuthor：测试用例生成与验证\n- RustImplementer：Rust代码生成与移植\n- SafetyRefiner：安全性检查与优化\n- MigrationAuditor：质量审计与进度验证\n\n【断点恢复机制设计】\n为 jarvis_c2rust.library_replacer.apply_library_replacement 增加断点恢复能力：\n\n【新增参数（向后兼容）】\n- resume: bool = True（默认启用恢复）\n- checkpoint_path: Optional[Path]（默认使用 .jarvis/c2rust/library_replacer_checkpoint.json）\n- checkpoint_interval: int = 1（每处理N个节点保存一次进度）\n- clear_checkpoint_on_done: bool = True（完成后清理checkpoint）\n\n【Checkpoint内容】\n- key: { sjsonl绝对路径, library_name, llm_group, candidates(排序去重), disabled_libraries(归一化), max_funcs }\n- eval_counter, processed_roots(list[int]), pruned_dynamic(list[int]), selected_roots([{fid,res}])\n\n【恢复逻辑】\n- 如果 resume 且 checkpoint 存在且 key 匹配，则加载上述集合，跳过已处理节点，沿用已剪枝与已选根\n\n【保存策略】\n- 每次评估节点后，若达到 checkpoint_interval 则保存，使用临时文件+原子替换\n- 完成后根据 clear_checkpoint_on_done 清理checkpoint文件\n\n【设计原则】\n- 一次只调用一个工具：确保操作的原子性和可追踪性\n- 产出必须先落盘：使用 REWRITE/PATCH 后再交接，保证状态一致性\n- 最小侵入改造：不破坏现有代码结构和构建系统\n- 文件即状态：通过文件存在性与内容判断阶段推进\n- 环境变量控制：通过 USE_RUST_BRIDGE 环境变量实现回退与切换\n\n【阶段推进机制】\n- 阶段推进依赖上述文件存在性与内容判断\n- 每个阶段完成后生成相应的状态文件\n- 支持从任意阶段断点续跑，无需从头开始\n\n【Oh-Sec 安全分析工作流优化】\n\n【核心原则】\n在 src/jarvis/oh_sec 中，即使是 agent 模式也不能完全交由 agent 执行，应先进行正则扫描获得候选问题，然后将扫描结果拆分为原子化子任务，交给 agent 逐项分析与验证。\n\n【工作流设计】\n需要在现有流程中加入\"扫描->子任务切分->agent分发->结果汇总\"，并保持本地静态规则与报告生成的兼容性与稳定性。\n\n【实施策略】\n- 正则扫描：使用本地静态规则快速识别潜在安全问题\n- 子任务切分：将扫描结果拆分为原子化、可独立处理的任务单元\n- Agent分发：将子任务分配给相应的 agent 进行深度分析与验证\n- 结果汇总：聚合 agent 分析结果，生成统一的安全报告\n\n【设计约束】\n- 保持本地静态规则的兼容性与稳定性\n- 确保 agent 分析的准确性与一致性\n- 支持增量处理与断点恢复\n- 维护报告生成的标准化流程\n\n【预期效果】\n- 提高安全分析的效率与准确性\n- 减少重复分析与资源浪费\n- 建立可扩展的安全分析工作流\n- 确保分析结果的可追溯性与可验证性\n\n【系统集成】\n- 两个系统均采用渐进式、可断点恢复的设计理念\n- 都强调最小侵入改造与状态管理的重要性\n- 都支持工具化、自动化的流程执行\n- 都具备完整的审计轨迹与质量控制机制",
  "tags": [
    "jarvis_c2rust",
    "oh-sec",
    "checkpoint",
    "resume",
    "multi_agent",
    "workflow",
    "state_management",
    "incremental_migration",
    "file_state",
    "security_analysis",
    "task_decomposition",
    "progressive_transformation",
    "automated_pipeline"
  ],
  "type": "project_long_term",
  "merged_from": ["merged_d0ac258b", "20251019_111420_024258"],
  "id": "merged_1e28a6b1",
  "created_at": "2025-11-12T23:45:47.901865"
}
