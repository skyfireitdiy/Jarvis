{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "frameworks/native/c_wrapper/source/hisysevent_rust_querier.cpp", "line": 48, "evidence": "if (sysEvents == nullptr || sysEvents->empty()) {", "confidence": 0.6, "severity": "high", "gid": 71, "verify": "验证sysEvents指针在解引用前非空", "has_risk": true, "preconditions": "sysEvents指针可能为nullptr", "trigger_path": "调用路径推导：HiSysEventManager::Query() -> HiSysEventBaseManager::Query() -> HiSysEventDelegate::Query() -> HiSysEventQueryProxy::OnQuery() -> HiSysEventBaseQueryCallback::OnQuery() -> HiSysEventRustQuerier::OnQuery()。数据流：查询结果通过IPC传递，最终回调到OnQuery()。关键调用点：测试用例中直接传入nullptr，生产代码路径中未对所有调用路径进行空指针校验。", "consequences": "空指针解引用导致程序崩溃", "suggestions": "在HiSysEventRustQuerier::OnQuery()入口处增加sysEvents指针的非空校验", "verification_notes": "分析结论正确，代码确实存在sysEvents指针为nullptr的可能性，触发路径分析准确，后果评估合理，且已在入口处进行空指针校验"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "frameworks/native/c_wrapper/source/hisysevent_rust_querier.cpp", "line": 52, "evidence": "size_t size = sysEvents->size();", "confidence": 0.6, "severity": "high", "gid": 73, "verify": "验证sysEvents指针在解引用前非空", "has_risk": true, "preconditions": "sysEvents指针可能为nullptr", "trigger_path": "调用路径推导：HiSysEventManager::Query() -> HiSysEventBaseManager::Query() -> HiSysEventDelegate::Query() -> HiSysEventQueryProxy::OnQuery() -> HiSysEventBaseQueryCallback::OnQuery() -> HiSysEventRustQuerier::OnQuery()。数据流：查询结果通过IPC传递，最终回调到OnQuery()。关键调用点：测试用例中直接传入nullptr，生产代码路径中未对所有调用路径进行空指针校验。", "consequences": "空指针解引用导致程序崩溃", "suggestions": "在HiSysEventRustQuerier::OnQuery()入口处增加sysEvents指针的非空校验", "verification_notes": "分析结论正确，代码确实存在sysEvents指针为nullptr的可能性，触发路径分析准确，后果评估合理，且已在入口处进行空指针校验"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "frameworks/native/c_wrapper/source/hisysevent_rust_querier.cpp", "line": 59, "evidence": "if (HiSysEventRecordConvertor::ConvertRecord(sysEvents->at(i), records[i]) != 0) {", "confidence": 0.6, "severity": "high", "gid": 74, "verify": "验证sysEvents指针在解引用前非空", "has_risk": true, "preconditions": "sysEvents指针可能为nullptr", "trigger_path": "调用路径推导：HiSysEventManager::Query() -> HiSysEventBaseManager::Query() -> HiSysEventDelegate::Query() -> HiSysEventQueryProxy::OnQuery() -> HiSysEventBaseQueryCallback::OnQuery() -> HiSysEventRustQuerier::OnQuery()。数据流：查询结果通过IPC传递，最终回调到OnQuery()。关键调用点：测试用例中直接传入nullptr，生产代码路径中未对所有调用路径进行空指针校验。", "consequences": "空指针解引用导致程序崩溃", "suggestions": "在HiSysEventRustQuerier::OnQuery()入口处增加sysEvents指针的非空校验", "verification_notes": "分析结论正确，代码确实存在sysEvents指针为nullptr的可能性，触发路径分析准确，后果评估合理，且已在入口处进行空指针校验"}
{"language": "c/cpp", "category": "buffer_overflow", "pattern": "vector_bounds_check", "file": "frameworks/native/c_wrapper/source/hisysevent_rust_manager.cpp", "line": 178, "evidence": "int OhHiSysEventAddRustWatcher(HiSysEventRustWatcherC* watcher, const HiSysEventWatchRule watchRules[],", "confidence": 0.6, "severity": "medium", "gid": 102, "verify": "验证容器访问不越界", "has_risk": true, "preconditions": "调用者未正确验证 ruleSize 参数与 rules 数组长度的匹配关系", "trigger_path": "调用路径推导：OhHiSysEventAddRustWatcher() -> HiSysEventAddWatcher()。数据流：外部传入的 watchRules 数组和 ruleSize 参数直接传递给 HiSysEventAddWatcher。关键调用点：HiSysEventAddWatcher() 函数未验证 ruleSize 与 rules 数组的实际长度关系，仅检查了 watcher 的有效性。", "consequences": "可能导致数组越界访问，引发程序崩溃或内存破坏", "suggestions": "在 HiSysEventAddWatcher 中添加对 ruleSize 和 rules 数组长度的验证逻辑，或确保所有调用者正确维护参数一致性", "verification_notes": "分析结论正确：\n1. 前置条件合理：HiSysEventAddWatcher函数确实未验证ruleSize与rules数组长度的匹配关系\n2. 触发路径成立：调用路径OhHiSysEventAddRustWatcher->HiSysEventAddWatcher正确，直接传递未经验证的参数\n3. 后果评估准确：确实可能导致数组越界访问风险\n4. 建议合适：添加参数验证逻辑是合理的改进方案\n代码验证：\n- 第84-110行显示HiSysEventAddWatcher仅检查watcher有效性\n- 第90-94行直接使用ruleSize循环访问rules数组\n- 第178-182行显示OhHiSysEventAddRustWatcher直接转发参数"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani_util.cpp", "line": 66, "evidence": "if (ANI_OK != env->FindClass(CLASS_NAME_ARRAY, &cls)) {", "confidence": 0.6, "severity": "high", "gid": 123, "verify": "Verify env pointer is not null and FindClass call returns ANI_OK before using cls pointer", "has_risk": true, "preconditions": "调用者传入的 ani_env *env 参数为 null", "trigger_path": "调用路径推导：外部调用者 -> HiSysEventAniUtil 类方法（如 IsArray(), ParseBigintValue() 等）。数据流：env 指针作为参数直接传递给 HiSysEventAniUtil 类方法，这些方法直接调用 env->FindClass() 而未检查 env 是否为 null。关键调用点：所有 HiSysEventAniUtil 方法都未对 env 参数进行空指针检查。", "consequences": "空指针解引用，导致程序崩溃", "suggestions": "在所有 HiSysEventAniUtil 方法开始处添加 env 指针的非空检查，如：if (env == nullptr) { return ...; }", "verification_notes": "分析结论正确，所有HiSysEventAniUtil方法确实未对env参数进行空指针检查，前置条件合理，触发路径清晰，后果评估准确，建议合适"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani_util.cpp", "line": 96, "evidence": "if (ANI_OK != env->FindClass(CLASS_NAME_BIGINT, &cls)) {", "confidence": 0.6, "severity": "high", "gid": 127, "verify": "Verify env pointer is not null and FindClass call returns ANI_OK before using cls pointer", "has_risk": true, "preconditions": "调用者传入的 ani_env *env 参数为 null", "trigger_path": "调用路径推导：外部调用者 -> HiSysEventAniUtil 类方法（如 IsArray(), ParseBigintValue() 等）。数据流：env 指针作为参数直接传递给 HiSysEventAniUtil 类方法，这些方法直接调用 env->FindClass() 而未检查 env 是否为 null。关键调用点：所有 HiSysEventAniUtil 方法都未对 env 参数进行空指针检查。", "consequences": "空指针解引用，导致程序崩溃", "suggestions": "在所有 HiSysEventAniUtil 方法开始处添加 env 指针的非空检查，如：if (env == nullptr) { return ...; }", "verification_notes": "分析结论正确，所有HiSysEventAniUtil方法确实未对env参数进行空指针检查，前置条件合理，触发路径清晰，后果评估准确，建议合适"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani_util.cpp", "line": 116, "evidence": "if (ANI_OK != env->FindClass(CLASS_NAME_BOOLEAN, &cls)) {", "confidence": 0.6, "severity": "high", "gid": 130, "verify": "Verify env pointer is not null and FindClass call returns ANI_OK before using cls pointer", "has_risk": true, "preconditions": "调用者传入的 ani_env *env 参数为 null", "trigger_path": "调用路径推导：外部调用者 -> HiSysEventAniUtil 类方法（如 IsArray(), ParseBigintValue() 等）。数据流：env 指针作为参数直接传递给 HiSysEventAniUtil 类方法，这些方法直接调用 env->FindClass() 而未检查 env 是否为 null。关键调用点：所有 HiSysEventAniUtil 方法都未对 env 参数进行空指针检查。", "consequences": "空指针解引用，导致程序崩溃", "suggestions": "在所有 HiSysEventAniUtil 方法开始处添加 env 指针的非空检查，如：if (env == nullptr) { return ...; }", "verification_notes": "分析结论正确，所有HiSysEventAniUtil方法确实未对env参数进行空指针检查，前置条件合理，触发路径清晰，后果评估准确，建议合适"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani_util.cpp", "line": 136, "evidence": "if (ANI_OK != env->FindClass(CLASS_NAME_INT, &cls)) {", "confidence": 0.6, "severity": "high", "gid": 133, "verify": "Verify env pointer is not null and FindClass call returns ANI_OK before using cls pointer", "has_risk": true, "preconditions": "调用者传入的 ani_env *env 参数为 null", "trigger_path": "调用路径推导：外部调用者 -> HiSysEventAniUtil 类方法（如 IsArray(), ParseBigintValue() 等）。数据流：env 指针作为参数直接传递给 HiSysEventAniUtil 类方法，这些方法直接调用 env->FindClass() 而未检查 env 是否为 null。关键调用点：所有 HiSysEventAniUtil 方法都未对 env 参数进行空指针检查。", "consequences": "空指针解引用，导致程序崩溃", "suggestions": "在所有 HiSysEventAniUtil 方法开始处添加 env 指针的非空检查，如：if (env == nullptr) { return ...; }", "verification_notes": "分析结论正确，所有HiSysEventAniUtil方法确实未对env参数进行空指针检查，前置条件合理，触发路径清晰，后果评估准确，建议合适"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani_util.cpp", "line": 156, "evidence": "if (ANI_OK != env->FindClass(CLASS_NAME_DOUBLE, &cls)) {", "confidence": 0.6, "severity": "high", "gid": 136, "verify": "Verify env pointer is not null and FindClass call returns ANI_OK before using cls pointer", "has_risk": true, "preconditions": "调用者传入的 ani_env *env 参数为 null", "trigger_path": "调用路径推导：外部调用者 -> HiSysEventAniUtil 类方法（如 IsArray(), ParseBigintValue() 等）。数据流：env 指针作为参数直接传递给 HiSysEventAniUtil 类方法，这些方法直接调用 env->FindClass() 而未检查 env 是否为 null。关键调用点：所有 HiSysEventAniUtil 方法都未对 env 参数进行空指针检查。", "consequences": "空指针解引用，导致程序崩溃", "suggestions": "在所有 HiSysEventAniUtil 方法开始处添加 env 指针的非空检查，如：if (env == nullptr) { return ...; }", "verification_notes": "分析结论正确，所有HiSysEventAniUtil方法确实未对env参数进行空指针检查，前置条件合理，触发路径清晰，后果评估准确，建议合适"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani_util.cpp", "line": 301, "evidence": "if (ANI_OK != env->FindClass(CLASS_NAME_RESULTINNER, &cls)) {", "confidence": 0.6, "severity": "high", "gid": 146, "verify": "Verify env pointer is not null and FindClass call returns ANI_OK before using cls pointer", "has_risk": true, "preconditions": "调用者传入的 ani_env *env 参数为 null", "trigger_path": "调用路径推导：外部调用者 -> HiSysEventAniUtil 类方法（如 IsArray(), ParseBigintValue() 等）。数据流：env 指针作为参数直接传递给 HiSysEventAniUtil 类方法，这些方法直接调用 env->FindClass() 而未检查 env 是否为 null。关键调用点：所有 HiSysEventAniUtil 方法都未对 env 参数进行空指针检查。", "consequences": "空指针解引用，导致程序崩溃", "suggestions": "在所有 HiSysEventAniUtil 方法开始处添加 env 指针的非空检查，如：if (env == nullptr) { return ...; }", "verification_notes": "分析结论正确，所有HiSysEventAniUtil方法确实未对env参数进行空指针检查，前置条件合理，触发路径清晰，后果评估准确，建议合适"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani_util.cpp", "line": 340, "evidence": "if (ANI_OK != env->FindClass(CLASS_NAME_DOUBLE, &personCls)) {", "confidence": 0.6, "severity": "high", "gid": 154, "verify": "Verify env pointer is not null and FindClass call returns ANI_OK before using cls pointer", "has_risk": true, "preconditions": "调用者传入的 ani_env *env 参数为 null", "trigger_path": "调用路径推导：外部调用者 -> HiSysEventAniUtil 类方法（如 IsArray(), ParseBigintValue() 等）。数据流：env 指针作为参数直接传递给 HiSysEventAniUtil 类方法，这些方法直接调用 env->FindClass() 而未检查 env 是否为 null。关键调用点：所有 HiSysEventAniUtil 方法都未对 env 参数进行空指针检查。", "consequences": "空指针解引用，导致程序崩溃", "suggestions": "在所有 HiSysEventAniUtil 方法开始处添加 env 指针的非空检查，如：if (env == nullptr) { return ...; }", "verification_notes": "分析结论正确，所有HiSysEventAniUtil方法确实未对env参数进行空指针检查，前置条件合理，触发路径清晰，后果评估准确，建议合适"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani_util.cpp", "line": 360, "evidence": "if (ANI_OK != env->FindClass(CLASS_NAME_DOUBLE, &personCls)) {", "confidence": 0.6, "severity": "high", "gid": 157, "verify": "Verify env pointer is not null and FindClass call returns ANI_OK before using cls pointer", "has_risk": true, "preconditions": "调用者传入的 ani_env *env 参数为 null", "trigger_path": "调用路径推导：外部调用者 -> HiSysEventAniUtil 类方法（如 IsArray(), ParseBigintValue() 等）。数据流：env 指针作为参数直接传递给 HiSysEventAniUtil 类方法，这些方法直接调用 env->FindClass() 而未检查 env 是否为 null。关键调用点：所有 HiSysEventAniUtil 方法都未对 env 参数进行空指针检查。", "consequences": "空指针解引用，导致程序崩溃", "suggestions": "在所有 HiSysEventAniUtil 方法开始处添加 env 指针的非空检查，如：if (env == nullptr) { return ...; }", "verification_notes": "分析结论正确，所有HiSysEventAniUtil方法确实未对env参数进行空指针检查，前置条件合理，触发路径清晰，后果评估准确，建议合适"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani_util.cpp", "line": 380, "evidence": "if (ANI_OK != env->FindClass(CLASS_NAME_BOOLEAN, &personCls)) {", "confidence": 0.6, "severity": "high", "gid": 160, "verify": "Verify env pointer is not null and FindClass call returns ANI_OK before using cls pointer", "has_risk": true, "preconditions": "调用者传入的 ani_env *env 参数为 null", "trigger_path": "调用路径推导：外部调用者 -> HiSysEventAniUtil 类方法（如 IsArray(), ParseBigintValue() 等）。数据流：env 指针作为参数直接传递给 HiSysEventAniUtil 类方法，这些方法直接调用 env->FindClass() 而未检查 env 是否为 null。关键调用点：所有 HiSysEventAniUtil 方法都未对 env 参数进行空指针检查。", "consequences": "空指针解引用，导致程序崩溃", "suggestions": "在所有 HiSysEventAniUtil 方法开始处添加 env 指针的非空检查，如：if (env == nullptr) { return ...; }", "verification_notes": "分析结论正确，所有HiSysEventAniUtil方法确实未对env参数进行空指针检查，前置条件合理，触发路径清晰，后果评估准确，建议合适"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani_util.cpp", "line": 400, "evidence": "if (ANI_OK != env->FindClass(CLASS_NAME_DOUBLE, &personCls)) {", "confidence": 0.6, "severity": "high", "gid": 163, "verify": "Verify env pointer is not null and FindClass call returns ANI_OK before using cls pointer", "has_risk": true, "preconditions": "调用者传入的 ani_env *env 参数为 null", "trigger_path": "调用路径推导：外部调用者 -> HiSysEventAniUtil 类方法（如 IsArray(), ParseBigintValue() 等）。数据流：env 指针作为参数直接传递给 HiSysEventAniUtil 类方法，这些方法直接调用 env->FindClass() 而未检查 env 是否为 null。关键调用点：所有 HiSysEventAniUtil 方法都未对 env 参数进行空指针检查。", "consequences": "空指针解引用，导致程序崩溃", "suggestions": "在所有 HiSysEventAniUtil 方法开始处添加 env 指针的非空检查，如：if (env == nullptr) { return ...; }", "verification_notes": "分析结论正确，所有HiSysEventAniUtil方法确实未对env参数进行空指针检查，前置条件合理，触发路径清晰，后果评估准确，建议合适"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani_util.cpp", "line": 420, "evidence": "if (ANI_OK != env->FindClass(CLASS_NAME_DOUBLE, &personCls)) {", "confidence": 0.6, "severity": "high", "gid": 166, "verify": "Verify env pointer is not null and FindClass call returns ANI_OK before using cls pointer", "has_risk": true, "preconditions": "调用者传入的 ani_env *env 参数为 null", "trigger_path": "调用路径推导：外部调用者 -> HiSysEventAniUtil 类方法（如 IsArray(), ParseBigintValue() 等）。数据流：env 指针作为参数直接传递给 HiSysEventAniUtil 类方法，这些方法直接调用 env->FindClass() 而未检查 env 是否为 null。关键调用点：所有 HiSysEventAniUtil 方法都未对 env 参数进行空指针检查。", "consequences": "空指针解引用，导致程序崩溃", "suggestions": "在所有 HiSysEventAniUtil 方法开始处添加 env 指针的非空检查，如：if (env == nullptr) { return ...; }", "verification_notes": "分析结论正确，所有HiSysEventAniUtil方法确实未对env参数进行空指针检查，前置条件合理，触发路径清晰，后果评估准确，建议合适"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani_util.cpp", "line": 461, "evidence": "if (ANI_OK != env->FindClass(CLASS_NAME_DOUBLE, &personCls)) {", "confidence": 0.6, "severity": "high", "gid": 172, "verify": "Verify env pointer is not null and FindClass call returns ANI_OK before using cls pointer", "has_risk": true, "preconditions": "调用者传入的 ani_env *env 参数为 null", "trigger_path": "调用路径推导：外部调用者 -> HiSysEventAniUtil 类方法（如 IsArray(), ParseBigintValue() 等）。数据流：env 指针作为参数直接传递给 HiSysEventAniUtil 类方法，这些方法直接调用 env->FindClass() 而未检查 env 是否为 null。关键调用点：所有 HiSysEventAniUtil 方法都未对 env 参数进行空指针检查。", "consequences": "空指针解引用，导致程序崩溃", "suggestions": "在所有 HiSysEventAniUtil 方法开始处添加 env 指针的非空检查，如：if (env == nullptr) { return ...; }", "verification_notes": "分析结论正确，所有HiSysEventAniUtil方法确实未对env参数进行空指针检查，前置条件合理，触发路径清晰，后果评估准确，建议合适"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani_util.cpp", "line": 82, "evidence": "env->Reference_IsUndefined(ref, &isUndefined);", "confidence": 0.6, "severity": "high", "gid": 126, "verify": "Verify env pointer is not null and all relevant parameter pointers are valid before API call", "has_risk": true, "preconditions": "env 指针为 null 或无效", "trigger_path": "调用路径推导：ANI框架 -> HiSysEvent接口函数 -> HiSysEventAniUtil类方法。数据流：env指针由ANI框架传入，在调用链中未进行空指针校验，直接传递给HiSysEventAniUtil类方法使用。关键调用点：所有使用env指针的HiSysEventAniUtil方法均未对env指针进行校验。", "consequences": "可能导致程序崩溃或未定义行为", "suggestions": "1. 在所有使用env指针的函数入口处添加空指针检查；2. 或明确文档说明env指针由框架保证非空", "verification_notes": "分析结论正确，项目记忆确认HiSysEventAniUtil工具方法依赖调用方验证env指针，前置条件合理，触发路径清晰，未验证的指针确实可能导致崩溃，建议添加验证或文档说明是合适的解决方案"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani_util.cpp", "line": 176, "evidence": "if (ANI_OK != env->Object_CallMethodByName_Ref(static_cast<ani_object>(recordRef), \"    \",", "confidence": 0.6, "severity": "high", "gid": 139, "verify": "Verify env pointer is not null and all relevant parameter pointers are valid before API call", "has_risk": true, "preconditions": "env 指针为 null 或无效", "trigger_path": "调用路径推导：ANI框架 -> HiSysEvent接口函数 -> HiSysEventAniUtil类方法。数据流：env指针由ANI框架传入，在调用链中未进行空指针校验，直接传递给HiSysEventAniUtil类方法使用。关键调用点：所有使用env指针的HiSysEventAniUtil方法均未对env指针进行校验。", "consequences": "可能导致程序崩溃或未定义行为", "suggestions": "1. 在所有使用env指针的函数入口处添加空指针检查；2. 或明确文档说明env指针由框架保证非空", "verification_notes": "分析结论正确，项目记忆确认HiSysEventAniUtil工具方法依赖调用方验证env指针，前置条件合理，触发路径清晰，未验证的指针确实可能导致崩溃，建议添加验证或文档说明是合适的解决方案"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani_util.cpp", "line": 184, "evidence": "if (ANI_OK != env->Object_CallMethodByName_Ref(static_cast<ani_object>(keys), \"    \", nullptr, &next)) {", "confidence": 0.6, "severity": "high", "gid": 140, "verify": "Verify env pointer is not null and all relevant parameter pointers are valid before API call", "has_risk": true, "preconditions": "env 指针为 null 或无效", "trigger_path": "调用路径推导：ANI框架 -> HiSysEvent接口函数 -> HiSysEventAniUtil类方法。数据流：env指针由ANI框架传入，在调用链中未进行空指针校验，直接传递给HiSysEventAniUtil类方法使用。关键调用点：所有使用env指针的HiSysEventAniUtil方法均未对env指针进行校验。", "consequences": "可能导致程序崩溃或未定义行为", "suggestions": "1. 在所有使用env指针的函数入口处添加空指针检查；2. 或明确文档说明env指针由框架保证非空", "verification_notes": "分析结论正确，项目记忆确认HiSysEventAniUtil工具方法依赖调用方验证env指针，前置条件合理，触发路径清晰，未验证的指针确实可能导致崩溃，建议添加验证或文档说明是合适的解决方案"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani_util.cpp", "line": 201, "evidence": "if (ANI_OK != env->Object_CallMethodByName_Ref(static_cast<ani_object>(recordRef),", "confidence": 0.6, "severity": "high", "gid": 143, "verify": "Verify env pointer is not null and all relevant parameter pointers are valid before API call", "has_risk": true, "preconditions": "env 指针为 null 或无效", "trigger_path": "调用路径推导：ANI框架 -> HiSysEvent接口函数 -> HiSysEventAniUtil类方法。数据流：env指针由ANI框架传入，在调用链中未进行空指针校验，直接传递给HiSysEventAniUtil类方法使用。关键调用点：所有使用env指针的HiSysEventAniUtil方法均未对env指针进行校验。", "consequences": "可能导致程序崩溃或未定义行为", "suggestions": "1. 在所有使用env指针的函数入口处添加空指针检查；2. 或明确文档说明env指针由框架保证非空", "verification_notes": "分析结论正确，项目记忆确认HiSysEventAniUtil工具方法依赖调用方验证env指针，前置条件合理，触发路径清晰，未验证的指针确实可能导致崩溃，建议添加验证或文档说明是合适的解决方案"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani_util.cpp", "line": 219, "evidence": "if (ANI_OK != env->String_GetUTF8Size(static_cast<ani_string>(aniStrRef), &strSize)) {", "confidence": 0.6, "severity": "high", "gid": 144, "verify": "Verify env pointer is not null and all relevant parameter pointers are valid before API call", "has_risk": true, "preconditions": "env 指针为 null 或无效", "trigger_path": "调用路径推导：ANI框架 -> HiSysEvent接口函数 -> HiSysEventAniUtil类方法。数据流：env指针由ANI框架传入，在调用链中未进行空指针校验，直接传递给HiSysEventAniUtil类方法使用。关键调用点：所有使用env指针的HiSysEventAniUtil方法均未对env指针进行校验。", "consequences": "可能导致程序崩溃或未定义行为", "suggestions": "1. 在所有使用env指针的函数入口处添加空指针检查；2. 或明确文档说明env指针由框架保证非空", "verification_notes": "分析结论正确，项目记忆确认HiSysEventAniUtil工具方法依赖调用方验证env指针，前置条件合理，触发路径清晰，未验证的指针确实可能导致崩溃，建议添加验证或文档说明是合适的解决方案"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani_util.cpp", "line": 226, "evidence": "if (ANI_OK != env->String_GetUTF8(static_cast<ani_string>(aniStrRef), utf8Buffer, strSize + 1, &bytesWritten)) {", "confidence": 0.6, "severity": "high", "gid": 145, "verify": "Verify env pointer is not null and all relevant parameter pointers are valid before API call", "has_risk": true, "preconditions": "env 指针为 null 或无效", "trigger_path": "调用路径推导：ANI框架 -> HiSysEvent接口函数 -> HiSysEventAniUtil类方法。数据流：env指针由ANI框架传入，在调用链中未进行空指针校验，直接传递给HiSysEventAniUtil类方法使用。关键调用点：所有使用env指针的HiSysEventAniUtil方法均未对env指针进行校验。", "consequences": "可能导致程序崩溃或未定义行为", "suggestions": "1. 在所有使用env指针的函数入口处添加空指针检查；2. 或明确文档说明env指针由框架保证非空", "verification_notes": "分析结论正确，项目记忆确认HiSysEventAniUtil工具方法依赖调用方验证env指针，前置条件合理，触发路径清晰，未验证的指针确实可能导致崩溃，建议添加验证或文档说明是合适的解决方案"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani_util.cpp", "line": 328, "evidence": "env->String_NewUTF8(message.c_str(), message.size(), &message_string);", "confidence": 0.6, "severity": "high", "gid": 152, "verify": "Verify env pointer is not null and all relevant parameter pointers are valid before API call", "has_risk": true, "preconditions": "env 指针为 null 或无效", "trigger_path": "调用路径推导：ANI框架 -> HiSysEvent接口函数 -> HiSysEventAniUtil类方法。数据流：env指针由ANI框架传入，在调用链中未进行空指针校验，直接传递给HiSysEventAniUtil类方法使用。关键调用点：所有使用env指针的HiSysEventAniUtil方法均未对env指针进行校验。", "consequences": "可能导致程序崩溃或未定义行为", "suggestions": "1. 在所有使用env指针的函数入口处添加空指针检查；2. 或明确文档说明env指针由框架保证非空", "verification_notes": "分析结论正确，项目记忆确认HiSysEventAniUtil工具方法依赖调用方验证env指针，前置条件合理，触发路径清晰，未验证的指针确实可能导致崩溃，建议添加验证或文档说明是合适的解决方案"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani_util.cpp", "line": 444, "evidence": "ani_int enumIndex = static_cast<ani_int>(it->second);", "confidence": 0.6, "severity": "high", "gid": 169, "verify": "Verify env pointer is not null and all relevant parameter pointers are valid before API call", "has_risk": true, "preconditions": "env 指针为 null 或无效", "trigger_path": "调用路径推导：ANI框架 -> HiSysEvent接口函数 -> HiSysEventAniUtil类方法。数据流：env指针由ANI框架传入，在调用链中未进行空指针校验，直接传递给HiSysEventAniUtil类方法使用。关键调用点：所有使用env指针的HiSysEventAniUtil方法均未对env指针进行校验。", "consequences": "可能导致程序崩溃或未定义行为", "suggestions": "1. 在所有使用env指针的函数入口处添加空指针检查；2. 或明确文档说明env指针由框架保证非空", "verification_notes": "分析结论正确，项目记忆确认HiSysEventAniUtil工具方法依赖调用方验证env指针，前置条件合理，触发路径清晰，未验证的指针确实可能导致崩溃，建议添加验证或文档说明是合适的解决方案"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani_util.cpp", "line": 446, "evidence": "if (ANI_OK != env->FindEnum(ENUM_NAME_EVENT_TYPE, &aniEnum)) {", "confidence": 0.6, "severity": "high", "gid": 170, "verify": "Verify env pointer is not null and all relevant parameter pointers are valid before API call", "has_risk": true, "preconditions": "env 指针为 null 或无效", "trigger_path": "调用路径推导：ANI框架 -> HiSysEvent接口函数 -> HiSysEventAniUtil类方法。数据流：env指针由ANI框架传入，在调用链中未进行空指针校验，直接传递给HiSysEventAniUtil类方法使用。关键调用点：所有使用env指针的HiSysEventAniUtil方法均未对env指针进行校验。", "consequences": "可能导致程序崩溃或未定义行为", "suggestions": "1. 在所有使用env指针的函数入口处添加空指针检查；2. 或明确文档说明env指针由框架保证非空", "verification_notes": "分析结论正确，项目记忆确认HiSysEventAniUtil工具方法依赖调用方验证env指针，前置条件合理，触发路径清晰，未验证的指针确实可能导致崩溃，建议添加验证或文档说明是合适的解决方案"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani_util.cpp", "line": 450, "evidence": "if (env->Enum_GetEnumItemByIndex(aniEnum, enumIndex, &aniEnumItem)) {", "confidence": 0.6, "severity": "high", "gid": 171, "verify": "Verify env pointer is not null and all relevant parameter pointers are valid before API call", "has_risk": true, "preconditions": "env 指针为 null 或无效", "trigger_path": "调用路径推导：ANI框架 -> HiSysEvent接口函数 -> HiSysEventAniUtil类方法。数据流：env指针由ANI框架传入，在调用链中未进行空指针校验，直接传递给HiSysEventAniUtil类方法使用。关键调用点：所有使用env指针的HiSysEventAniUtil方法均未对env指针进行校验。", "consequences": "可能导致程序崩溃或未定义行为", "suggestions": "1. 在所有使用env指针的函数入口处添加空指针检查；2. 或明确文档说明env指针由框架保证非空", "verification_notes": "分析结论正确，项目记忆确认HiSysEventAniUtil工具方法依赖调用方验证env指针，前置条件合理，触发路径清晰，未验证的指针确实可能导致崩溃，建议添加验证或文档说明是合适的解决方案"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani_util.cpp", "line": 466, "evidence": "if (ANI_OK != env->Class_FindMethod(personCls, \"      \", \"   \", &personInfoCtor)) {", "confidence": 0.6, "severity": "high", "gid": 173, "verify": "env指针在调用JNI方法前非空", "has_risk": true, "preconditions": "传入的env指针为null", "trigger_path": "调用路径推导：外部调用者 -> HiSysEventAniUtil类的静态方法（如CreateDoubleUint32/CreateStringValue/ThrowAniError等）。数据流：env指针作为参数直接传入静态方法，方法内部未进行空指针检查直接使用。关键调用点：所有HiSysEventAniUtil类的静态方法都未对env指针进行校验。", "consequences": "空指针解引用导致程序崩溃", "suggestions": "在所有JNI方法调用前添加env指针的非空检查", "verification_notes": "分析结论正确，所有HiSysEventAniUtil类的静态方法确实未对env指针进行空指针校验，存在空指针解引用风险"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani_util.cpp", "line": 470, "evidence": "if (ANI_OK != env->Object_New(personCls, personInfoCtor, &personInfoObj, static_cast<ani_double>(number))) {", "confidence": 0.6, "severity": "high", "gid": 174, "verify": "env指针在调用JNI方法前非空", "has_risk": true, "preconditions": "传入的env指针为null", "trigger_path": "调用路径推导：外部调用者 -> HiSysEventAniUtil类的静态方法（如CreateDoubleUint32/CreateStringValue/ThrowAniError等）。数据流：env指针作为参数直接传入静态方法，方法内部未进行空指针检查直接使用。关键调用点：所有HiSysEventAniUtil类的静态方法都未对env指针进行校验。", "consequences": "空指针解引用导致程序崩溃", "suggestions": "在所有JNI方法调用前添加env指针的非空检查", "verification_notes": "分析结论正确，所有HiSysEventAniUtil类的静态方法确实未对env指针进行空指针校验，存在空指针解引用风险"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani_util.cpp", "line": 480, "evidence": "if (ANI_OK != env->String_NewUTF8(value.c_str(), value.size(), &valueStr)) {", "confidence": 0.6, "severity": "high", "gid": 175, "verify": "env指针在调用JNI方法前非空", "has_risk": true, "preconditions": "传入的env指针为null", "trigger_path": "调用路径推导：外部调用者 -> HiSysEventAniUtil类的静态方法（如CreateDoubleUint32/CreateStringValue/ThrowAniError等）。数据流：env指针作为参数直接传入静态方法，方法内部未进行空指针检查直接使用。关键调用点：所有HiSysEventAniUtil类的静态方法都未对env指针进行校验。", "consequences": "空指针解引用导致程序崩溃", "suggestions": "在所有JNI方法调用前添加env指针的非空检查", "verification_notes": "分析结论正确，所有HiSysEventAniUtil类的静态方法确实未对env指针进行空指针校验，存在空指针解引用风险"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani_util.cpp", "line": 490, "evidence": "if (ANI_OK != env->FindClass(CLASS_NAME_BUSINESSERROR, &cls)) {", "confidence": 0.6, "severity": "high", "gid": 176, "verify": "env指针在调用JNI方法前非空", "has_risk": true, "preconditions": "传入的env指针为null", "trigger_path": "调用路径推导：外部调用者 -> HiSysEventAniUtil类的静态方法（如CreateDoubleUint32/CreateStringValue/ThrowAniError等）。数据流：env指针作为参数直接传入静态方法，方法内部未进行空指针检查直接使用。关键调用点：所有HiSysEventAniUtil类的静态方法都未对env指针进行校验。", "consequences": "空指针解引用导致程序崩溃", "suggestions": "在所有JNI方法调用前添加env指针的非空检查", "verification_notes": "分析结论正确，所有HiSysEventAniUtil类的静态方法确实未对env指针进行空指针校验，存在空指针解引用风险"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani_util.cpp", "line": 495, "evidence": "if (ANI_OK != env->Class_FindMethod(cls, \"      \", \"  \", &ctor)) {", "confidence": 0.6, "severity": "high", "gid": 177, "verify": "env指针在调用JNI方法前非空", "has_risk": true, "preconditions": "传入的env指针为null", "trigger_path": "调用路径推导：外部调用者 -> HiSysEventAniUtil类的静态方法（如CreateDoubleUint32/CreateStringValue/ThrowAniError等）。数据流：env指针作为参数直接传入静态方法，方法内部未进行空指针检查直接使用。关键调用点：所有HiSysEventAniUtil类的静态方法都未对env指针进行校验。", "consequences": "空指针解引用导致程序崩溃", "suggestions": "在所有JNI方法调用前添加env指针的非空检查", "verification_notes": "分析结论正确，所有HiSysEventAniUtil类的静态方法确实未对env指针进行空指针校验，存在空指针解引用风险"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani_util.cpp", "line": 500, "evidence": "if (ANI_OK != env->Object_New(cls, ctor, &error)) {", "confidence": 0.6, "severity": "high", "gid": 178, "verify": "env指针在调用JNI方法前非空", "has_risk": true, "preconditions": "传入的env指针为null", "trigger_path": "调用路径推导：外部调用者 -> HiSysEventAniUtil类的静态方法（如CreateDoubleUint32/CreateStringValue/ThrowAniError等）。数据流：env指针作为参数直接传入静态方法，方法内部未进行空指针检查直接使用。关键调用点：所有HiSysEventAniUtil类的静态方法都未对env指针进行校验。", "consequences": "空指针解引用导致程序崩溃", "suggestions": "在所有JNI方法调用前添加env指针的非空检查", "verification_notes": "分析结论正确，所有HiSysEventAniUtil类的静态方法确实未对env指针进行空指针校验，存在空指针解引用风险"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani_util.cpp", "line": 504, "evidence": "if (ANI_OK != env->Object_SetPropertyByName_Double(error, \"    \", static_cast<ani_double>(code))) {", "confidence": 0.6, "severity": "high", "gid": 179, "verify": "env指针在调用JNI方法前非空", "has_risk": true, "preconditions": "传入的env指针为null", "trigger_path": "调用路径推导：外部调用者 -> HiSysEventAniUtil类的静态方法（如CreateDoubleUint32/CreateStringValue/ThrowAniError等）。数据流：env指针作为参数直接传入静态方法，方法内部未进行空指针检查直接使用。关键调用点：所有HiSysEventAniUtil类的静态方法都未对env指针进行校验。", "consequences": "空指针解引用导致程序崩溃", "suggestions": "在所有JNI方法调用前添加env指针的非空检查", "verification_notes": "分析结论正确，所有HiSysEventAniUtil类的静态方法确实未对env指针进行空指针校验，存在空指针解引用风险"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani_util.cpp", "line": 509, "evidence": "if (ANI_OK != env->String_NewUTF8(message.c_str(), message.size(), &messageRef)) {", "confidence": 0.6, "severity": "high", "gid": 180, "verify": "env指针在调用JNI方法前非空", "has_risk": true, "preconditions": "传入的env指针为null", "trigger_path": "调用路径推导：外部调用者 -> HiSysEventAniUtil类的静态方法（如CreateDoubleUint32/CreateStringValue/ThrowAniError等）。数据流：env指针作为参数直接传入静态方法，方法内部未进行空指针检查直接使用。关键调用点：所有HiSysEventAniUtil类的静态方法都未对env指针进行校验。", "consequences": "空指针解引用导致程序崩溃", "suggestions": "在所有JNI方法调用前添加env指针的非空检查", "verification_notes": "分析结论正确，所有HiSysEventAniUtil类的静态方法确实未对env指针进行空指针校验，存在空指针解引用风险"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani_util.cpp", "line": 513, "evidence": "if (ANI_OK != env->Object_SetPropertyByName_Ref(error, \"       \", static_cast<ani_ref>(messageRef))) {", "confidence": 0.6, "severity": "high", "gid": 181, "verify": "env指针在调用JNI方法前非空", "has_risk": true, "preconditions": "传入的env指针为null", "trigger_path": "调用路径推导：外部调用者 -> HiSysEventAniUtil类的静态方法（如CreateDoubleUint32/CreateStringValue/ThrowAniError等）。数据流：env指针作为参数直接传入静态方法，方法内部未进行空指针检查直接使用。关键调用点：所有HiSysEventAniUtil类的静态方法都未对env指针进行校验。", "consequences": "空指针解引用导致程序崩溃", "suggestions": "在所有JNI方法调用前添加env指针的非空检查", "verification_notes": "分析结论正确，所有HiSysEventAniUtil类的静态方法确实未对env指针进行空指针校验，存在空指针解引用风险"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani_util.cpp", "line": 517, "evidence": "if (ANI_OK != env->ThrowError(static_cast<ani_error>(error))) {", "confidence": 0.6, "severity": "high", "gid": 182, "verify": "env指针在调用JNI方法前非空", "has_risk": true, "preconditions": "传入的env指针为null", "trigger_path": "调用路径推导：外部调用者 -> HiSysEventAniUtil类的静态方法（如CreateDoubleUint32/CreateStringValue/ThrowAniError等）。数据流：env指针作为参数直接传入静态方法，方法内部未进行空指针检查直接使用。关键调用点：所有HiSysEventAniUtil类的静态方法都未对env指针进行校验。", "consequences": "空指针解引用导致程序崩溃", "suggestions": "在所有JNI方法调用前添加env指针的非空检查", "verification_notes": "分析结论正确，所有HiSysEventAniUtil类的静态方法确实未对env指针进行空指针校验，存在空指针解引用风险"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani_util.cpp", "line": 546, "evidence": "if (ANI_OK != env->FindClass(CLASS_NAME_SYSEVENTINFOANI, &cls)) {", "confidence": 0.6, "severity": "high", "gid": 183, "verify": "env指针在调用JNI方法前非空", "has_risk": true, "preconditions": "传入的env指针为null", "trigger_path": "调用路径推导：外部调用者 -> HiSysEventAniUtil类的静态方法（如CreateDoubleUint32/CreateStringValue/ThrowAniError等）。数据流：env指针作为参数直接传入静态方法，方法内部未进行空指针检查直接使用。关键调用点：所有HiSysEventAniUtil类的静态方法都未对env指针进行校验。", "consequences": "空指针解引用导致程序崩溃", "suggestions": "在所有JNI方法调用前添加env指针的非空检查", "verification_notes": "分析结论正确，所有HiSysEventAniUtil类的静态方法确实未对env指针进行空指针校验，存在空指针解引用风险"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani_util.cpp", "line": 551, "evidence": "if (ANI_OK != env->Object_SetPropertyByName_Ref(sysEventInfo, \"         \", static_cast<ani_ref>(eventType_ctor))) {", "confidence": 0.6, "severity": "high", "gid": 184, "verify": "env指针在调用JNI方法前非空", "has_risk": true, "preconditions": "传入的env指针为null", "trigger_path": "调用路径推导：外部调用者 -> HiSysEventAniUtil类的静态方法（如CreateDoubleUint32/CreateStringValue/ThrowAniError等）。数据流：env指针作为参数直接传入静态方法，方法内部未进行空指针检查直接使用。关键调用点：所有HiSysEventAniUtil类的静态方法都未对env指针进行校验。", "consequences": "空指针解引用导致程序崩溃", "suggestions": "在所有JNI方法调用前添加env指针的非空检查", "verification_notes": "分析结论正确，所有HiSysEventAniUtil类的静态方法确实未对env指针进行空指针校验，存在空指针解引用风险"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani_util.cpp", "line": 560, "evidence": "if (ANI_OK != env->FindClass(CLASS_NAME_SYSEVENTINFOANI, &cls)) {", "confidence": 0.6, "severity": "high", "gid": 185, "verify": "env指针在调用JNI方法前非空", "has_risk": true, "preconditions": "传入的env指针为null", "trigger_path": "调用路径推导：外部调用者 -> HiSysEventAniUtil类的静态方法（如CreateDoubleUint32/CreateStringValue/ThrowAniError等）。数据流：env指针作为参数直接传入静态方法，方法内部未进行空指针检查直接使用。关键调用点：所有HiSysEventAniUtil类的静态方法都未对env指针进行校验。", "consequences": "空指针解引用导致程序崩溃", "suggestions": "在所有JNI方法调用前添加env指针的非空检查", "verification_notes": "分析结论正确，所有HiSysEventAniUtil类的静态方法确实未对env指针进行空指针校验，存在空指针解引用风险"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani_util.cpp", "line": 567, "evidence": "if (ANI_OK != env->Object_SetPropertyByName_Ref(sysEventInfo, \"      \", static_cast<ani_ref>(domain_ctor))) {", "confidence": 0.6, "severity": "high", "gid": 186, "verify": "env指针在调用JNI方法前非空", "has_risk": true, "preconditions": "传入的env指针为null", "trigger_path": "调用路径推导：外部调用者 -> HiSysEventAniUtil类的静态方法（如CreateDoubleUint32/CreateStringValue/ThrowAniError等）。数据流：env指针作为参数直接传入静态方法，方法内部未进行空指针检查直接使用。关键调用点：所有HiSysEventAniUtil类的静态方法都未对env指针进行校验。", "consequences": "空指针解引用导致程序崩溃", "suggestions": "在所有JNI方法调用前添加env指针的非空检查", "verification_notes": "分析结论正确，所有HiSysEventAniUtil类的静态方法确实未对env指针进行空指针校验，存在空指针解引用风险"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani_util.cpp", "line": 572, "evidence": "if (ANI_OK != env->Object_SetPropertyByName_Ref(sysEventInfo, \"    \", static_cast<ani_ref>(name_ctor))) {", "confidence": 0.6, "severity": "high", "gid": 187, "verify": "env指针在调用JNI方法前非空", "has_risk": true, "preconditions": "传入的env指针为null", "trigger_path": "调用路径推导：外部调用者 -> HiSysEventAniUtil类的静态方法（如CreateDoubleUint32/CreateStringValue/ThrowAniError等）。数据流：env指针作为参数直接传入静态方法，方法内部未进行空指针检查直接使用。关键调用点：所有HiSysEventAniUtil类的静态方法都未对env指针进行校验。", "consequences": "空指针解引用导致程序崩溃", "suggestions": "在所有JNI方法调用前添加env指针的非空检查", "verification_notes": "分析结论正确，所有HiSysEventAniUtil类的静态方法确实未对env指针进行空指针校验，存在空指针解引用风险"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani_util.cpp", "line": 630, "evidence": "if (ANI_OK != env->FindClass(CLASS_NAME_SYSEVENTINFOANI, &cls)) {", "confidence": 0.6, "severity": "high", "gid": 188, "verify": "env指针在调用JNI方法前非空", "has_risk": true, "preconditions": "传入的env指针为null", "trigger_path": "调用路径推导：外部调用者 -> HiSysEventAniUtil类的静态方法（如CreateDoubleUint32/CreateStringValue/ThrowAniError等）。数据流：env指针作为参数直接传入静态方法，方法内部未进行空指针检查直接使用。关键调用点：所有HiSysEventAniUtil类的静态方法都未对env指针进行校验。", "consequences": "空指针解引用导致程序崩溃", "suggestions": "在所有JNI方法调用前添加env指针的非空检查", "verification_notes": "分析结论正确，所有HiSysEventAniUtil类的静态方法确实未对env指针进行空指针校验，存在空指针解引用风险"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani_util.cpp", "line": 635, "evidence": "if (ANI_OK != env->Array_New_Ref(cls, len, initial_array, &array)) {", "confidence": 0.6, "severity": "high", "gid": 189, "verify": "env指针在调用JNI方法前非空", "has_risk": true, "preconditions": "传入的env指针为null", "trigger_path": "调用路径推导：外部调用者 -> HiSysEventAniUtil类的静态方法（如CreateDoubleUint32/CreateStringValue/ThrowAniError等）。数据流：env指针作为参数直接传入静态方法，方法内部未进行空指针检查直接使用。关键调用点：所有HiSysEventAniUtil类的静态方法都未对env指针进行校验。", "consequences": "空指针解引用导致程序崩溃", "suggestions": "在所有JNI方法调用前添加env指针的非空检查", "verification_notes": "分析结论正确，所有HiSysEventAniUtil类的静态方法确实未对env指针进行空指针校验，存在空指针解引用风险"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani_util.cpp", "line": 644, "evidence": "if (ANI_OK != env->Array_Set_Ref(array, i, static_cast<ani_ref>(item))) {", "confidence": 0.6, "severity": "high", "gid": 190, "verify": "env指针在调用JNI方法前非空", "has_risk": true, "preconditions": "传入的env指针为null", "trigger_path": "调用路径推导：外部调用者 -> HiSysEventAniUtil类的静态方法（如CreateDoubleUint32/CreateStringValue/ThrowAniError等）。数据流：env指针作为参数直接传入静态方法，方法内部未进行空指针检查直接使用。关键调用点：所有HiSysEventAniUtil类的静态方法都未对env指针进行校验。", "consequences": "空指针解引用导致程序崩溃", "suggestions": "在所有JNI方法调用前添加env指针的非空检查", "verification_notes": "分析结论正确，所有HiSysEventAniUtil类的静态方法确实未对env指针进行空指针校验，存在空指针解引用风险"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani_util.cpp", "line": 649, "evidence": "if (ANI_OK != env->Object_SetPropertyByName_Ref(sysEventInfo, \"      \", static_cast<ani_ref>(array))) {", "confidence": 0.6, "severity": "high", "gid": 191, "verify": "env指针在调用JNI方法前非空", "has_risk": true, "preconditions": "传入的env指针为null", "trigger_path": "调用路径推导：外部调用者 -> HiSysEventAniUtil类的静态方法（如CreateDoubleUint32/CreateStringValue/ThrowAniError等）。数据流：env指针作为参数直接传入静态方法，方法内部未进行空指针检查直接使用。关键调用点：所有HiSysEventAniUtil类的静态方法都未对env指针进行校验。", "consequences": "空指针解引用导致程序崩溃", "suggestions": "在所有JNI方法调用前添加env指针的非空检查", "verification_notes": "分析结论正确，所有HiSysEventAniUtil类的静态方法确实未对env指针进行空指针校验，存在空指针解引用风险"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani_util.cpp", "line": 664, "evidence": "if (ANI_OK != env->Object_SetPropertyByName_Ref(sysEventInfo, \"      \", static_cast<ani_ref>(property))) {", "confidence": 0.6, "severity": "high", "gid": 192, "verify": "env指针在调用JNI方法前非空", "has_risk": true, "preconditions": "传入的env指针为null", "trigger_path": "调用路径推导：外部调用者 -> HiSysEventAniUtil类的静态方法（如CreateDoubleUint32/CreateStringValue/ThrowAniError等）。数据流：env指针作为参数直接传入静态方法，方法内部未进行空指针检查直接使用。关键调用点：所有HiSysEventAniUtil类的静态方法都未对env指针进行校验。", "consequences": "空指针解引用导致程序崩溃", "suggestions": "在所有JNI方法调用前添加env指针的非空检查", "verification_notes": "分析结论正确，所有HiSysEventAniUtil类的静态方法确实未对env指针进行空指针校验，存在空指针解引用风险"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani_util.cpp", "line": 679, "evidence": "if (ANI_OK != env->FindClass(CLASS_NAME_SYSEVENTINFOANI, &cls)) {", "confidence": 0.6, "severity": "high", "gid": 193, "verify": "env指针在调用JNI方法前非空", "has_risk": true, "preconditions": "传入的env指针为null", "trigger_path": "调用路径推导：外部调用者 -> HiSysEventAniUtil类的静态方法（如CreateDoubleUint32/CreateStringValue/ThrowAniError等）。数据流：env指针作为参数直接传入静态方法，方法内部未进行空指针检查直接使用。关键调用点：所有HiSysEventAniUtil类的静态方法都未对env指针进行校验。", "consequences": "空指针解引用导致程序崩溃", "suggestions": "在所有JNI方法调用前添加env指针的非空检查", "verification_notes": "分析结论正确，所有HiSysEventAniUtil类的静态方法确实未对env指针进行空指针校验，存在空指针解引用风险"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani_util.cpp", "line": 685, "evidence": "if (ANI_OK != env->Class_FindMethod(cls, \"      \", nullptr, &ctor)) {", "confidence": 0.6, "severity": "high", "gid": 194, "verify": "env指针在调用JNI方法前非空", "has_risk": true, "preconditions": "传入的env指针为null", "trigger_path": "调用路径推导：外部调用者 -> HiSysEventAniUtil类的静态方法（如CreateDoubleUint32/CreateStringValue/ThrowAniError等）。数据流：env指针作为参数直接传入静态方法，方法内部未进行空指针检查直接使用。关键调用点：所有HiSysEventAniUtil类的静态方法都未对env指针进行校验。", "consequences": "空指针解引用导致程序崩溃", "suggestions": "在所有JNI方法调用前添加env指针的非空检查", "verification_notes": "分析结论正确，所有HiSysEventAniUtil类的静态方法确实未对env指针进行空指针校验，存在空指针解引用风险"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani_util.cpp", "line": 690, "evidence": "if (ANI_OK != env->Object_New(cls, ctor, &sysEventInfo)) {", "confidence": 0.6, "severity": "high", "gid": 195, "verify": "env指针在调用JNI方法前非空", "has_risk": true, "preconditions": "传入的env指针为null", "trigger_path": "调用路径推导：外部调用者 -> HiSysEventAniUtil类的静态方法（如CreateDoubleUint32/CreateStringValue/ThrowAniError等）。数据流：env指针作为参数直接传入静态方法，方法内部未进行空指针检查直接使用。关键调用点：所有HiSysEventAniUtil类的静态方法都未对env指针进行校验。", "consequences": "空指针解引用导致程序崩溃", "suggestions": "在所有JNI方法调用前添加env指针的非空检查", "verification_notes": "分析结论正确，所有HiSysEventAniUtil类的静态方法确实未对env指针进行空指针校验，存在空指针解引用风险"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani_util.cpp", "line": 695, "evidence": "ani_status ret = env->Array_Set_Ref(sysEventInfoJsArray, i, static_cast<ani_ref>(sysEventInfo));", "confidence": 0.6, "severity": "high", "gid": 196, "verify": "env指针在调用JNI方法前非空", "has_risk": true, "preconditions": "传入的env指针为null", "trigger_path": "调用路径推导：外部调用者 -> HiSysEventAniUtil类的静态方法（如CreateDoubleUint32/CreateStringValue/ThrowAniError等）。数据流：env指针作为参数直接传入静态方法，方法内部未进行空指针检查直接使用。关键调用点：所有HiSysEventAniUtil类的静态方法都未对env指针进行校验。", "consequences": "空指针解引用导致程序崩溃", "suggestions": "在所有JNI方法调用前添加env指针的非空检查", "verification_notes": "分析结论正确，所有HiSysEventAniUtil类的静态方法确实未对env指针进行空指针校验，存在空指针解引用风险"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani_util.cpp", "line": 741, "evidence": "env->String_GetUTF8Size(aniStr, &strSize);", "confidence": 0.6, "severity": "high", "gid": 199, "verify": "字符串指针在操作前非空", "has_risk": true, "preconditions": "ani_string参数为null", "trigger_path": "调用路径推导：HiSysEventAni::WriteInner() -> GetStack() -> HiSysEventAniUtil::AniStringToStdString()。数据流：stackTraceStr来自Object_CallMethodByName_Ref调用，未检查返回值是否为null。关键调用点：Object_CallMethodByName_Ref调用后未检查stackTraceStr是否为null。", "consequences": "空指针解引用，可能导致程序崩溃", "suggestions": "在调用AniStringToStdString前检查aniStr参数是否为null，或在该函数内部添加参数校验", "verification_notes": "分析结论正确：\n1. 前置条件合理：AniStringToStdString函数确实没有对aniStr参数进行空指针检查\n2. 触发路径成立：调用路径HiSysEventAni::WriteInner() -> GetStack() -> HiSysEventAniUtil::AniStringToStdString()确实存在，且GetStack()中调用Object_CallMethodByName_Ref后未检查返回值\n3. 后果评估准确：确实可能导致空指针解引用和程序崩溃\n4. 建议合适：建议在调用前或函数内添加空指针检查是合理的解决方案"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani_util.cpp", "line": 745, "evidence": "env->String_GetUTF8(aniStr, utf8Buffer, strSize + 1, &bytesWritten);", "confidence": 0.6, "severity": "high", "gid": 200, "verify": "字符串指针在操作前非空", "has_risk": true, "preconditions": "ani_string参数为null", "trigger_path": "调用路径推导：HiSysEventAni::WriteInner() -> GetStack() -> HiSysEventAniUtil::AniStringToStdString()。数据流：stackTraceStr来自Object_CallMethodByName_Ref调用，未检查返回值是否为null。关键调用点：Object_CallMethodByName_Ref调用后未检查stackTraceStr是否为null。", "consequences": "空指针解引用，可能导致程序崩溃", "suggestions": "在调用AniStringToStdString前检查aniStr参数是否为null，或在该函数内部添加参数校验", "verification_notes": "分析结论正确：\n1. 前置条件合理：AniStringToStdString函数确实没有对aniStr参数进行空指针检查\n2. 触发路径成立：调用路径HiSysEventAni::WriteInner() -> GetStack() -> HiSysEventAniUtil::AniStringToStdString()确实存在，且GetStack()中调用Object_CallMethodByName_Ref后未检查返回值\n3. 后果评估准确：确实可能导致空指针解引用和程序崩溃\n4. 建议合适：建议在调用前或函数内添加空指针检查是合理的解决方案"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/ani_hisysevent_querier.cpp", "line": 46, "evidence": "if (ANI_OK == callbackContextAni->vm->GetEnv(ANI_VERSION_1, &env) && env != nullptr) {", "confidence": 0.6, "severity": "high", "gid": 248, "verify": "callbackContextAni and its members (vm, ref) are not null before dereference", "has_risk": true, "preconditions": "callbackContextAni或其成员(vm, ref)在使用前被意外置为null", "trigger_path": "调用路径推导：hisysevent_ani.cpp创建CallbackContextAni -> AniHiSysEventQuerier构造函数 -> 析构函数/OnComplete使用。数据流：vm参数通过hisysevent_ani.cpp传入，querierRef通过env->GlobalReference_Create创建。关键调用点：AniHiSysEventQuerier构造函数接收callbackContextAni后未做空指针检查，直接存储使用。", "consequences": "空指针解引用导致程序崩溃", "suggestions": "1. 在AniHiSysEventQuerier构造函数中添加空指针检查；2. 使用智能指针管理callbackContextAni生命周期；3. 在析构函数和OnComplete中添加防御性空指针检查", "verification_notes": "分析结论正确，前置条件合理（callbackContextAni可能被置为null），触发路径清晰（创建->构造函数->析构函数使用），后果评估准确（空指针解引用风险），建议合适（添加空指针检查和智能指针管理）"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/ani_hisysevent_querier.cpp", "line": 46, "evidence": "if (ANI_OK == callbackContextAni->vm->GetEnv(ANI_VERSION_1, &env) && env != nullptr) {", "confidence": 0.6, "severity": "high", "gid": 249, "verify": "callbackContextAni and its members (vm, ref) are not null before dereference", "has_risk": true, "preconditions": "callbackContextAni或其成员(vm, ref)在使用前被意外置为null", "trigger_path": "调用路径推导：hisysevent_ani.cpp创建CallbackContextAni -> AniHiSysEventQuerier构造函数 -> 析构函数/OnComplete使用。数据流：vm参数通过hisysevent_ani.cpp传入，querierRef通过env->GlobalReference_Create创建。关键调用点：AniHiSysEventQuerier构造函数接收callbackContextAni后未做空指针检查，直接存储使用。", "consequences": "空指针解引用导致程序崩溃", "suggestions": "1. 在AniHiSysEventQuerier构造函数中添加空指针检查；2. 使用智能指针管理callbackContextAni生命周期；3. 在析构函数和OnComplete中添加防御性空指针检查", "verification_notes": "分析结论正确，前置条件合理（callbackContextAni可能被置为null），触发路径清晰（创建->构造函数->析构函数使用），后果评估准确（空指针解引用风险），建议合适（添加空指针检查和智能指针管理）"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/ani_hisysevent_querier.cpp", "line": 47, "evidence": "env->GlobalReference_Delete(callbackContextAni->ref);", "confidence": 0.6, "severity": "high", "gid": 250, "verify": "callbackContextAni and its members (vm, ref) are not null before dereference", "has_risk": true, "preconditions": "callbackContextAni或其成员(vm, ref)在使用前被意外置为null", "trigger_path": "调用路径推导：hisysevent_ani.cpp创建CallbackContextAni -> AniHiSysEventQuerier构造函数 -> 析构函数/OnComplete使用。数据流：vm参数通过hisysevent_ani.cpp传入，querierRef通过env->GlobalReference_Create创建。关键调用点：AniHiSysEventQuerier构造函数接收callbackContextAni后未做空指针检查，直接存储使用。", "consequences": "空指针解引用导致程序崩溃", "suggestions": "1. 在AniHiSysEventQuerier构造函数中添加空指针检查；2. 使用智能指针管理callbackContextAni生命周期；3. 在析构函数和OnComplete中添加防御性空指针检查", "verification_notes": "分析结论正确，前置条件合理（callbackContextAni可能被置为null），触发路径清晰（创建->构造函数->析构函数使用），后果评估准确（空指针解引用风险），建议合适（添加空指针检查和智能指针管理）"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/ani_hisysevent_querier.cpp", "line": 47, "evidence": "env->GlobalReference_Delete(callbackContextAni->ref);", "confidence": 0.6, "severity": "high", "gid": 251, "verify": "callbackContextAni and its members (vm, ref) are not null before dereference", "has_risk": true, "preconditions": "callbackContextAni或其成员(vm, ref)在使用前被意外置为null", "trigger_path": "调用路径推导：hisysevent_ani.cpp创建CallbackContextAni -> AniHiSysEventQuerier构造函数 -> 析构函数/OnComplete使用。数据流：vm参数通过hisysevent_ani.cpp传入，querierRef通过env->GlobalReference_Create创建。关键调用点：AniHiSysEventQuerier构造函数接收callbackContextAni后未做空指针检查，直接存储使用。", "consequences": "空指针解引用导致程序崩溃", "suggestions": "1. 在AniHiSysEventQuerier构造函数中添加空指针检查；2. 使用智能指针管理callbackContextAni生命周期；3. 在析构函数和OnComplete中添加防御性空指针检查", "verification_notes": "分析结论正确，前置条件合理（callbackContextAni可能被置为null），触发路径清晰（创建->构造函数->析构函数使用），后果评估准确（空指针解引用风险），建议合适（添加空指针检查和智能指针管理）"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/ani_hisysevent_querier.cpp", "line": 48, "evidence": "} else if (ANI_OK == callbackContextAni->vm->AttachCurrentThread(&aniArgs, ANI_VERSION_1, &env) && env != nullptr) {", "confidence": 0.6, "severity": "high", "gid": 252, "verify": "callbackContextAni and its members (vm, ref) are not null before dereference", "has_risk": true, "preconditions": "callbackContextAni或其成员(vm, ref)在使用前被意外置为null", "trigger_path": "调用路径推导：hisysevent_ani.cpp创建CallbackContextAni -> AniHiSysEventQuerier构造函数 -> 析构函数/OnComplete使用。数据流：vm参数通过hisysevent_ani.cpp传入，querierRef通过env->GlobalReference_Create创建。关键调用点：AniHiSysEventQuerier构造函数接收callbackContextAni后未做空指针检查，直接存储使用。", "consequences": "空指针解引用导致程序崩溃", "suggestions": "1. 在AniHiSysEventQuerier构造函数中添加空指针检查；2. 使用智能指针管理callbackContextAni生命周期；3. 在析构函数和OnComplete中添加防御性空指针检查", "verification_notes": "分析结论正确，前置条件合理（callbackContextAni可能被置为null），触发路径清晰（创建->构造函数->析构函数使用），后果评估准确（空指针解引用风险），建议合适（添加空指针检查和智能指针管理）"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/ani_hisysevent_querier.cpp", "line": 48, "evidence": "} else if (ANI_OK == callbackContextAni->vm->AttachCurrentThread(&aniArgs, ANI_VERSION_1, &env) && env != nullptr) {", "confidence": 0.6, "severity": "high", "gid": 253, "verify": "callbackContextAni and its members (vm, ref) are not null before dereference", "has_risk": true, "preconditions": "callbackContextAni或其成员(vm, ref)在使用前被意外置为null", "trigger_path": "调用路径推导：hisysevent_ani.cpp创建CallbackContextAni -> AniHiSysEventQuerier构造函数 -> 析构函数/OnComplete使用。数据流：vm参数通过hisysevent_ani.cpp传入，querierRef通过env->GlobalReference_Create创建。关键调用点：AniHiSysEventQuerier构造函数接收callbackContextAni后未做空指针检查，直接存储使用。", "consequences": "空指针解引用导致程序崩溃", "suggestions": "1. 在AniHiSysEventQuerier构造函数中添加空指针检查；2. 使用智能指针管理callbackContextAni生命周期；3. 在析构函数和OnComplete中添加防御性空指针检查", "verification_notes": "分析结论正确，前置条件合理（callbackContextAni可能被置为null），触发路径清晰（创建->构造函数->析构函数使用），后果评估准确（空指针解引用风险），建议合适（添加空指针检查和智能指针管理）"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/ani_hisysevent_querier.cpp", "line": 49, "evidence": "env->GlobalReference_Delete(callbackContextAni->ref);", "confidence": 0.6, "severity": "high", "gid": 254, "verify": "callbackContextAni and its members (vm, ref) are not null before dereference", "has_risk": true, "preconditions": "callbackContextAni或其成员(vm, ref)在使用前被意外置为null", "trigger_path": "调用路径推导：hisysevent_ani.cpp创建CallbackContextAni -> AniHiSysEventQuerier构造函数 -> 析构函数/OnComplete使用。数据流：vm参数通过hisysevent_ani.cpp传入，querierRef通过env->GlobalReference_Create创建。关键调用点：AniHiSysEventQuerier构造函数接收callbackContextAni后未做空指针检查，直接存储使用。", "consequences": "空指针解引用导致程序崩溃", "suggestions": "1. 在AniHiSysEventQuerier构造函数中添加空指针检查；2. 使用智能指针管理callbackContextAni生命周期；3. 在析构函数和OnComplete中添加防御性空指针检查", "verification_notes": "分析结论正确，前置条件合理（callbackContextAni可能被置为null），触发路径清晰（创建->构造函数->析构函数使用），后果评估准确（空指针解引用风险），建议合适（添加空指针检查和智能指针管理）"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/ani_hisysevent_querier.cpp", "line": 49, "evidence": "env->GlobalReference_Delete(callbackContextAni->ref);", "confidence": 0.6, "severity": "high", "gid": 255, "verify": "callbackContextAni and its members (vm, ref) are not null before dereference", "has_risk": true, "preconditions": "callbackContextAni或其成员(vm, ref)在使用前被意外置为null", "trigger_path": "调用路径推导：hisysevent_ani.cpp创建CallbackContextAni -> AniHiSysEventQuerier构造函数 -> 析构函数/OnComplete使用。数据流：vm参数通过hisysevent_ani.cpp传入，querierRef通过env->GlobalReference_Create创建。关键调用点：AniHiSysEventQuerier构造函数接收callbackContextAni后未做空指针检查，直接存储使用。", "consequences": "空指针解引用导致程序崩溃", "suggestions": "1. 在AniHiSysEventQuerier构造函数中添加空指针检查；2. 使用智能指针管理callbackContextAni生命周期；3. 在析构函数和OnComplete中添加防御性空指针检查", "verification_notes": "分析结论正确，前置条件合理（callbackContextAni可能被置为null），触发路径清晰（创建->构造函数->析构函数使用），后果评估准确（空指针解引用风险），建议合适（添加空指针检查和智能指针管理）"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/ani_hisysevent_querier.cpp", "line": 50, "evidence": "callbackContextAni->vm->DetachCurrentThread();", "confidence": 0.6, "severity": "high", "gid": 256, "verify": "callbackContextAni and its members (vm, ref) are not null before dereference", "has_risk": true, "preconditions": "callbackContextAni或其成员(vm, ref)在使用前被意外置为null", "trigger_path": "调用路径推导：hisysevent_ani.cpp创建CallbackContextAni -> AniHiSysEventQuerier构造函数 -> 析构函数/OnComplete使用。数据流：vm参数通过hisysevent_ani.cpp传入，querierRef通过env->GlobalReference_Create创建。关键调用点：AniHiSysEventQuerier构造函数接收callbackContextAni后未做空指针检查，直接存储使用。", "consequences": "空指针解引用导致程序崩溃", "suggestions": "1. 在AniHiSysEventQuerier构造函数中添加空指针检查；2. 使用智能指针管理callbackContextAni生命周期；3. 在析构函数和OnComplete中添加防御性空指针检查", "verification_notes": "分析结论正确，前置条件合理（callbackContextAni可能被置为null），触发路径清晰（创建->构造函数->析构函数使用），后果评估准确（空指针解引用风险），建议合适（添加空指针检查和智能指针管理）"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/ani_hisysevent_querier.cpp", "line": 50, "evidence": "callbackContextAni->vm->DetachCurrentThread();", "confidence": 0.6, "severity": "high", "gid": 257, "verify": "callbackContextAni and its members (vm, ref) are not null before dereference", "has_risk": true, "preconditions": "callbackContextAni或其成员(vm, ref)在使用前被意外置为null", "trigger_path": "调用路径推导：hisysevent_ani.cpp创建CallbackContextAni -> AniHiSysEventQuerier构造函数 -> 析构函数/OnComplete使用。数据流：vm参数通过hisysevent_ani.cpp传入，querierRef通过env->GlobalReference_Create创建。关键调用点：AniHiSysEventQuerier构造函数接收callbackContextAni后未做空指针检查，直接存储使用。", "consequences": "空指针解引用导致程序崩溃", "suggestions": "1. 在AniHiSysEventQuerier构造函数中添加空指针检查；2. 使用智能指针管理callbackContextAni生命周期；3. 在析构函数和OnComplete中添加防御性空指针检查", "verification_notes": "分析结论正确，前置条件合理（callbackContextAni可能被置为null），触发路径清晰（创建->构造函数->析构函数使用），后果评估准确（空指针解引用风险），建议合适（添加空指针检查和智能指针管理）"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/src/ani_hisysevent_querier.cpp", "line": 124, "evidence": "this->onCompleteHandler(vm, this->callbackContextAni->ref);", "confidence": 0.6, "severity": "high", "gid": 268, "verify": "callbackContextAni and its members (vm, ref) are not null before dereference", "has_risk": true, "preconditions": "callbackContextAni或其成员(vm, ref)在使用前被意外置为null", "trigger_path": "调用路径推导：hisysevent_ani.cpp创建CallbackContextAni -> AniHiSysEventQuerier构造函数 -> 析构函数/OnComplete使用。数据流：vm参数通过hisysevent_ani.cpp传入，querierRef通过env->GlobalReference_Create创建。关键调用点：AniHiSysEventQuerier构造函数接收callbackContextAni后未做空指针检查，直接存储使用。", "consequences": "空指针解引用导致程序崩溃", "suggestions": "1. 在AniHiSysEventQuerier构造函数中添加空指针检查；2. 使用智能指针管理callbackContextAni生命周期；3. 在析构函数和OnComplete中添加防御性空指针检查", "verification_notes": "分析结论正确，前置条件合理（callbackContextAni可能被置为null），触发路径清晰（创建->构造函数->析构函数使用），后果评估准确（空指针解引用风险），建议合适（添加空指针检查和智能指针管理）"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "alloc_no_null_check", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani.cpp", "line": 598, "evidence": "CallbackContextAni *callbackContextAni = new CallbackContextAni();", "confidence": 0.8, "severity": "high", "gid": 269, "verify": "检查 new 操作是否可能失败（内存不足时返回nullptr）", "has_risk": true, "preconditions": "系统内存不足导致new操作返回nullptr", "trigger_path": "调用路径推导：1) 可控输入来源：外部调用AddWatcher/Query API；2) 调用链：AddWatcher/Query -> new CallbackContextAni()；3) 调用点校验：入口函数检查了调用者权限但未检查内存分配情况；4) 触发条件：内存不足时new失败返回nullptr，后续立即解引用", "consequences": "空指针解引用导致程序崩溃或未定义行为", "suggestions": "1) 对new操作添加nullptr检查；2) 使用std::nothrow版本的new操作；3) 考虑使用智能指针管理内存", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "alloc_no_null_check", "file": "interfaces/ets/ani/hisysevent/src/hisysevent_ani.cpp", "line": 655, "evidence": "CallbackContextAni *callbackContextAni = new CallbackContextAni();", "confidence": 0.8, "severity": "high", "gid": 270, "verify": "检查 new 操作是否可能失败（内存不足时返回nullptr）", "has_risk": true, "preconditions": "系统内存不足导致new操作返回nullptr", "trigger_path": "调用路径推导：1) 可控输入来源：外部调用AddWatcher/Query API；2) 调用链：AddWatcher/Query -> new CallbackContextAni()；3) 调用点校验：入口函数检查了调用者权限但未检查内存分配情况；4) 触发条件：内存不足时new失败返回nullptr，后续立即解引用", "consequences": "空指针解引用导致程序崩溃或未定义行为", "suggestions": "1) 对new操作添加nullptr检查；2) 使用std::nothrow版本的new操作；3) 考虑使用智能指针管理内存", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/include/hisysevent_ani_util.h", "line": 121, "evidence": "if (iter->second.first != getproctid()) {", "confidence": 0.6, "severity": "high", "gid": 332, "verify": "指针iter和env在解引用前非空", "has_risk": true, "preconditions": "env指针来自AttachAniEnv可能返回nullptr，或iter指针等于resources.end()时被解引用", "trigger_path": "调用路径推导：1) 可控输入来源：通过AttachAniEnv获取的env指针；2) 调用链：AttachAniEnv() -> CompareAndReturnCacheItem() -> 解引用操作；3) 校验情况：AttachAniEnv可能返回nullptr但调用点未检查，CompareAndReturnCacheItem内部未检查env和iter指针；4) 触发条件：当AttachAniEnv返回nullptr或iter等于end()时解引用", "consequences": "空指针解引用可能导致程序崩溃或未定义行为", "suggestions": "1) 在调用AttachAniEnv后检查返回值；2) 在CompareAndReturnCacheItem函数内部添加对env和iter指针的校验", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/include/hisysevent_ani_util.h", "line": 124, "evidence": "ani_ref val = iter->first;", "confidence": 0.6, "severity": "high", "gid": 333, "verify": "指针iter和env在解引用前非空", "has_risk": true, "preconditions": "env指针来自AttachAniEnv可能返回nullptr，或iter指针等于resources.end()时被解引用", "trigger_path": "调用路径推导：1) 可控输入来源：通过AttachAniEnv获取的env指针；2) 调用链：AttachAniEnv() -> CompareAndReturnCacheItem() -> 解引用操作；3) 校验情况：AttachAniEnv可能返回nullptr但调用点未检查，CompareAndReturnCacheItem内部未检查env和iter指针；4) 触发条件：当AttachAniEnv返回nullptr或iter等于end()时解引用", "consequences": "空指针解引用可能导致程序崩溃或未定义行为", "suggestions": "1) 在调用AttachAniEnv后检查返回值；2) 在CompareAndReturnCacheItem函数内部添加对env和iter指针的校验", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/ets/ani/hisysevent/include/hisysevent_ani_util.h", "line": 126, "evidence": "ani_status ret = env->Reference_StrictEquals(standard, static_cast<ani_object>(val), &isEquals);", "confidence": 0.6, "severity": "high", "gid": 334, "verify": "指针iter和env在解引用前非空", "has_risk": true, "preconditions": "env指针来自AttachAniEnv可能返回nullptr，或iter指针等于resources.end()时被解引用", "trigger_path": "调用路径推导：1) 可控输入来源：通过AttachAniEnv获取的env指针；2) 调用链：AttachAniEnv() -> CompareAndReturnCacheItem() -> 解引用操作；3) 校验情况：AttachAniEnv可能返回nullptr但调用点未检查，CompareAndReturnCacheItem内部未检查env和iter指针；4) 触发条件：当AttachAniEnv返回nullptr或iter等于end()时解引用", "consequences": "空指针解引用可能导致程序崩溃或未定义行为", "suggestions": "1) 在调用AttachAniEnv后检查返回值；2) 在CompareAndReturnCacheItem函数内部添加对env和iter指针的校验", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "c/cpp", "category": "error_handling", "pattern": "io_call", "file": "interfaces/native/innerkits/hisysevent_easy/easy_socket_writer.c", "line": 69, "evidence": "close(socketId);", "confidence": 0.65, "severity": "medium", "gid": 350, "verify": "确认close(socketId)调用前socketId是否有效，以及是否检查了close的返回值", "has_risk": true, "preconditions": "socketId为无效文件描述符或close操作失败", "trigger_path": "调用路径推导：Write() -> close(socketId)。数据流：socketId来自TEMP_FAILURE_RETRY(socket(...))调用，在错误处理路径中直接调用close。关键调用点：行69在socketId<0时错误地调用close；其他close调用点未检查返回值。", "consequences": "可能导致资源泄漏或掩盖底层错误情况", "suggestions": "1. 移除行69的无效close调用；2. 其他close调用应检查返回值并记录错误；3. 建议使用包装函数安全关闭socket", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "c/cpp", "category": "error_handling", "pattern": "io_call", "file": "interfaces/native/innerkits/hisysevent_easy/easy_socket_writer.c", "line": 74, "evidence": "close(socketId);", "confidence": 0.65, "severity": "medium", "gid": 351, "verify": "确认close(socketId)调用前socketId是否有效，以及是否检查了close的返回值", "has_risk": true, "preconditions": "socketId为无效文件描述符或close操作失败", "trigger_path": "调用路径推导：Write() -> close(socketId)。数据流：socketId来自TEMP_FAILURE_RETRY(socket(...))调用，在错误处理路径中直接调用close。关键调用点：行69在socketId<0时错误地调用close；其他close调用点未检查返回值。", "consequences": "可能导致资源泄漏或掩盖底层错误情况", "suggestions": "1. 移除行69的无效close调用；2. 其他close调用应检查返回值并记录错误；3. 建议使用包装函数安全关闭socket", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "c/cpp", "category": "error_handling", "pattern": "io_call", "file": "interfaces/native/innerkits/hisysevent_easy/easy_socket_writer.c", "line": 80, "evidence": "close(socketId);", "confidence": 0.65, "severity": "medium", "gid": 352, "verify": "确认close(socketId)调用前socketId是否有效，以及是否检查了close的返回值", "has_risk": true, "preconditions": "socketId为无效文件描述符或close操作失败", "trigger_path": "调用路径推导：Write() -> close(socketId)。数据流：socketId来自TEMP_FAILURE_RETRY(socket(...))调用，在错误处理路径中直接调用close。关键调用点：行69在socketId<0时错误地调用close；其他close调用点未检查返回值。", "consequences": "可能导致资源泄漏或掩盖底层错误情况", "suggestions": "1. 移除行69的无效close调用；2. 其他close调用应检查返回值并记录错误；3. 建议使用包装函数安全关闭socket", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "c/cpp", "category": "error_handling", "pattern": "io_call", "file": "interfaces/native/innerkits/hisysevent_easy/easy_socket_writer.c", "line": 92, "evidence": "close(socketId);", "confidence": 0.65, "severity": "medium", "gid": 353, "verify": "确认close(socketId)调用前socketId是否有效，以及是否检查了close的返回值", "has_risk": true, "preconditions": "socketId为无效文件描述符或close操作失败", "trigger_path": "调用路径推导：Write() -> close(socketId)。数据流：socketId来自TEMP_FAILURE_RETRY(socket(...))调用，在错误处理路径中直接调用close。关键调用点：行69在socketId<0时错误地调用close；其他close调用点未检查返回值。", "consequences": "可能导致资源泄漏或掩盖底层错误情况", "suggestions": "1. 移除行69的无效close调用；2. 其他close调用应检查返回值并记录错误；3. 建议使用包装函数安全关闭socket", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "c/cpp", "category": "error_handling", "pattern": "io_call", "file": "interfaces/native/innerkits/hisysevent_easy/easy_socket_writer.c", "line": 95, "evidence": "close(socketId);", "confidence": 0.65, "severity": "medium", "gid": 354, "verify": "确认close(socketId)调用前socketId是否有效，以及是否检查了close的返回值", "has_risk": true, "preconditions": "socketId为无效文件描述符或close操作失败", "trigger_path": "调用路径推导：Write() -> close(socketId)。数据流：socketId来自TEMP_FAILURE_RETRY(socket(...))调用，在错误处理路径中直接调用close。关键调用点：行69在socketId<0时错误地调用close；其他close调用点未检查返回值。", "consequences": "可能导致资源泄漏或掩盖底层错误情况", "suggestions": "1. 移除行69的无效close调用；2. 其他close调用应检查返回值并记录错误；3. 建议使用包装函数安全关闭socket", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/native/innerkits/hisysevent_manager/hisysevent_record_c.cpp", "line": 151, "evidence": "GetParamNames(*record, names, *len);", "confidence": 0.6, "severity": "high", "gid": 362, "verify": "检查指针在解引用前是否经过非空验证（record指针）", "has_risk": true, "preconditions": "record指针为nullptr", "trigger_path": "调用路径推导：外部调用 -> OH_HiSysEvent_GetParam*() -> GetParam*()。数据流：record指针可能来自外部输入，直接传递给OH_HiSysEvent_GetParam*()函数，这些函数内部直接解引用record指针而未做空指针检查。关键调用点：所有OH_HiSysEvent_GetParam*()函数均未对record指针进行空指针验证。", "consequences": "空指针解引用，导致程序崩溃", "suggestions": "在所有OH_HiSysEvent_GetParam*()函数入口处添加对record指针的非空检查，并在指针为null时返回错误码", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/native/innerkits/hisysevent_manager/hisysevent_record_c.cpp", "line": 151, "evidence": "GetParamNames(*record, names, *len);", "confidence": 0.6, "severity": "high", "gid": 363, "verify": "检查指针在解引用前是否经过非空验证（record指针）", "has_risk": true, "preconditions": "record指针为nullptr", "trigger_path": "调用路径推导：外部调用 -> OH_HiSysEvent_GetParam*() -> GetParam*()。数据流：record指针可能来自外部输入，直接传递给OH_HiSysEvent_GetParam*()函数，这些函数内部直接解引用record指针而未做空指针检查。关键调用点：所有OH_HiSysEvent_GetParam*()函数均未对record指针进行空指针验证。", "consequences": "空指针解引用，导致程序崩溃", "suggestions": "在所有OH_HiSysEvent_GetParam*()函数入口处添加对record指针的非空检查，并在指针为null时返回错误码", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/native/innerkits/hisysevent_manager/hisysevent_record_c.cpp", "line": 156, "evidence": "return GetParamInt64Value(*record, name, *value);", "confidence": 0.6, "severity": "high", "gid": 364, "verify": "检查指针在解引用前是否经过非空验证（record指针）", "has_risk": true, "preconditions": "record指针为nullptr", "trigger_path": "调用路径推导：外部调用 -> OH_HiSysEvent_GetParam*() -> GetParam*()。数据流：record指针可能来自外部输入，直接传递给OH_HiSysEvent_GetParam*()函数，这些函数内部直接解引用record指针而未做空指针检查。关键调用点：所有OH_HiSysEvent_GetParam*()函数均未对record指针进行空指针验证。", "consequences": "空指针解引用，导致程序崩溃", "suggestions": "在所有OH_HiSysEvent_GetParam*()函数入口处添加对record指针的非空检查，并在指针为null时返回错误码", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/native/innerkits/hisysevent_manager/hisysevent_record_c.cpp", "line": 156, "evidence": "return GetParamInt64Value(*record, name, *value);", "confidence": 0.6, "severity": "high", "gid": 365, "verify": "检查指针在解引用前是否经过非空验证（record指针）", "has_risk": true, "preconditions": "record指针为nullptr", "trigger_path": "调用路径推导：外部调用 -> OH_HiSysEvent_GetParam*() -> GetParam*()。数据流：record指针可能来自外部输入，直接传递给OH_HiSysEvent_GetParam*()函数，这些函数内部直接解引用record指针而未做空指针检查。关键调用点：所有OH_HiSysEvent_GetParam*()函数均未对record指针进行空指针验证。", "consequences": "空指针解引用，导致程序崩溃", "suggestions": "在所有OH_HiSysEvent_GetParam*()函数入口处添加对record指针的非空检查，并在指针为null时返回错误码", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/native/innerkits/hisysevent_manager/hisysevent_record_c.cpp", "line": 161, "evidence": "return GetParamUint64Value(*record, name, *value);", "confidence": 0.6, "severity": "high", "gid": 366, "verify": "检查指针在解引用前是否经过非空验证（record指针）", "has_risk": true, "preconditions": "record指针为nullptr", "trigger_path": "调用路径推导：外部调用 -> OH_HiSysEvent_GetParam*() -> GetParam*()。数据流：record指针可能来自外部输入，直接传递给OH_HiSysEvent_GetParam*()函数，这些函数内部直接解引用record指针而未做空指针检查。关键调用点：所有OH_HiSysEvent_GetParam*()函数均未对record指针进行空指针验证。", "consequences": "空指针解引用，导致程序崩溃", "suggestions": "在所有OH_HiSysEvent_GetParam*()函数入口处添加对record指针的非空检查，并在指针为null时返回错误码", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/native/innerkits/hisysevent_manager/hisysevent_record_c.cpp", "line": 161, "evidence": "return GetParamUint64Value(*record, name, *value);", "confidence": 0.6, "severity": "high", "gid": 367, "verify": "检查指针在解引用前是否经过非空验证（record指针）", "has_risk": true, "preconditions": "record指针为nullptr", "trigger_path": "调用路径推导：外部调用 -> OH_HiSysEvent_GetParam*() -> GetParam*()。数据流：record指针可能来自外部输入，直接传递给OH_HiSysEvent_GetParam*()函数，这些函数内部直接解引用record指针而未做空指针检查。关键调用点：所有OH_HiSysEvent_GetParam*()函数均未对record指针进行空指针验证。", "consequences": "空指针解引用，导致程序崩溃", "suggestions": "在所有OH_HiSysEvent_GetParam*()函数入口处添加对record指针的非空检查，并在指针为null时返回错误码", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/native/innerkits/hisysevent_manager/hisysevent_record_c.cpp", "line": 166, "evidence": "return GetParamDoubleValue(*record, name, *value);", "confidence": 0.6, "severity": "high", "gid": 368, "verify": "检查指针在解引用前是否经过非空验证（record指针）", "has_risk": true, "preconditions": "record指针为nullptr", "trigger_path": "调用路径推导：外部调用 -> OH_HiSysEvent_GetParam*() -> GetParam*()。数据流：record指针可能来自外部输入，直接传递给OH_HiSysEvent_GetParam*()函数，这些函数内部直接解引用record指针而未做空指针检查。关键调用点：所有OH_HiSysEvent_GetParam*()函数均未对record指针进行空指针验证。", "consequences": "空指针解引用，导致程序崩溃", "suggestions": "在所有OH_HiSysEvent_GetParam*()函数入口处添加对record指针的非空检查，并在指针为null时返回错误码", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/native/innerkits/hisysevent_manager/hisysevent_record_c.cpp", "line": 166, "evidence": "return GetParamDoubleValue(*record, name, *value);", "confidence": 0.6, "severity": "high", "gid": 369, "verify": "检查指针在解引用前是否经过非空验证（record指针）", "has_risk": true, "preconditions": "record指针为nullptr", "trigger_path": "调用路径推导：外部调用 -> OH_HiSysEvent_GetParam*() -> GetParam*()。数据流：record指针可能来自外部输入，直接传递给OH_HiSysEvent_GetParam*()函数，这些函数内部直接解引用record指针而未做空指针检查。关键调用点：所有OH_HiSysEvent_GetParam*()函数均未对record指针进行空指针验证。", "consequences": "空指针解引用，导致程序崩溃", "suggestions": "在所有OH_HiSysEvent_GetParam*()函数入口处添加对record指针的非空检查，并在指针为null时返回错误码", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/native/innerkits/hisysevent_manager/hisysevent_record_c.cpp", "line": 171, "evidence": "return GetParamStringValue(*record, name, value);", "confidence": 0.6, "severity": "high", "gid": 370, "verify": "检查指针在解引用前是否经过非空验证（record指针）", "has_risk": true, "preconditions": "record指针为nullptr", "trigger_path": "调用路径推导：外部调用 -> OH_HiSysEvent_GetParam*() -> GetParam*()。数据流：record指针可能来自外部输入，直接传递给OH_HiSysEvent_GetParam*()函数，这些函数内部直接解引用record指针而未做空指针检查。关键调用点：所有OH_HiSysEvent_GetParam*()函数均未对record指针进行空指针验证。", "consequences": "空指针解引用，导致程序崩溃", "suggestions": "在所有OH_HiSysEvent_GetParam*()函数入口处添加对record指针的非空检查，并在指针为null时返回错误码", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/native/innerkits/hisysevent_manager/hisysevent_record_c.cpp", "line": 176, "evidence": "return GetParamInt64Values(*record, name, value, *len);", "confidence": 0.6, "severity": "high", "gid": 371, "verify": "检查指针在解引用前是否经过非空验证（record指针）", "has_risk": true, "preconditions": "record指针为nullptr", "trigger_path": "调用路径推导：外部调用 -> OH_HiSysEvent_GetParam*() -> GetParam*()。数据流：record指针可能来自外部输入，直接传递给OH_HiSysEvent_GetParam*()函数，这些函数内部直接解引用record指针而未做空指针检查。关键调用点：所有OH_HiSysEvent_GetParam*()函数均未对record指针进行空指针验证。", "consequences": "空指针解引用，导致程序崩溃", "suggestions": "在所有OH_HiSysEvent_GetParam*()函数入口处添加对record指针的非空检查，并在指针为null时返回错误码", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/native/innerkits/hisysevent_manager/hisysevent_record_c.cpp", "line": 176, "evidence": "return GetParamInt64Values(*record, name, value, *len);", "confidence": 0.6, "severity": "high", "gid": 372, "verify": "检查指针在解引用前是否经过非空验证（record指针）", "has_risk": true, "preconditions": "record指针为nullptr", "trigger_path": "调用路径推导：外部调用 -> OH_HiSysEvent_GetParam*() -> GetParam*()。数据流：record指针可能来自外部输入，直接传递给OH_HiSysEvent_GetParam*()函数，这些函数内部直接解引用record指针而未做空指针检查。关键调用点：所有OH_HiSysEvent_GetParam*()函数均未对record指针进行空指针验证。", "consequences": "空指针解引用，导致程序崩溃", "suggestions": "在所有OH_HiSysEvent_GetParam*()函数入口处添加对record指针的非空检查，并在指针为null时返回错误码", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/native/innerkits/hisysevent_manager/hisysevent_record_c.cpp", "line": 181, "evidence": "return GetParamUint64Values(*record, name, value, *len);", "confidence": 0.6, "severity": "high", "gid": 373, "verify": "检查指针在解引用前是否经过非空验证（record指针）", "has_risk": true, "preconditions": "record指针为nullptr", "trigger_path": "调用路径推导：外部调用 -> OH_HiSysEvent_GetParam*() -> GetParam*()。数据流：record指针可能来自外部输入，直接传递给OH_HiSysEvent_GetParam*()函数，这些函数内部直接解引用record指针而未做空指针检查。关键调用点：所有OH_HiSysEvent_GetParam*()函数均未对record指针进行空指针验证。", "consequences": "空指针解引用，导致程序崩溃", "suggestions": "在所有OH_HiSysEvent_GetParam*()函数入口处添加对record指针的非空检查，并在指针为null时返回错误码", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/native/innerkits/hisysevent_manager/hisysevent_record_c.cpp", "line": 181, "evidence": "return GetParamUint64Values(*record, name, value, *len);", "confidence": 0.6, "severity": "high", "gid": 374, "verify": "检查指针在解引用前是否经过非空验证（record指针）", "has_risk": true, "preconditions": "record指针为nullptr", "trigger_path": "调用路径推导：外部调用 -> OH_HiSysEvent_GetParam*() -> GetParam*()。数据流：record指针可能来自外部输入，直接传递给OH_HiSysEvent_GetParam*()函数，这些函数内部直接解引用record指针而未做空指针检查。关键调用点：所有OH_HiSysEvent_GetParam*()函数均未对record指针进行空指针验证。", "consequences": "空指针解引用，导致程序崩溃", "suggestions": "在所有OH_HiSysEvent_GetParam*()函数入口处添加对record指针的非空检查，并在指针为null时返回错误码", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/native/innerkits/hisysevent_manager/hisysevent_record_c.cpp", "line": 186, "evidence": "return GetParamDoubleValues(*record, name, value, *len);", "confidence": 0.6, "severity": "high", "gid": 375, "verify": "检查指针在解引用前是否经过非空验证（record指针）", "has_risk": true, "preconditions": "record指针为nullptr", "trigger_path": "调用路径推导：外部调用 -> OH_HiSysEvent_GetParam*() -> GetParam*()。数据流：record指针可能来自外部输入，直接传递给OH_HiSysEvent_GetParam*()函数，这些函数内部直接解引用record指针而未做空指针检查。关键调用点：所有OH_HiSysEvent_GetParam*()函数均未对record指针进行空指针验证。", "consequences": "空指针解引用，导致程序崩溃", "suggestions": "在所有OH_HiSysEvent_GetParam*()函数入口处添加对record指针的非空检查，并在指针为null时返回错误码", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/native/innerkits/hisysevent_manager/hisysevent_record_c.cpp", "line": 186, "evidence": "return GetParamDoubleValues(*record, name, value, *len);", "confidence": 0.6, "severity": "high", "gid": 376, "verify": "检查指针在解引用前是否经过非空验证（record指针）", "has_risk": true, "preconditions": "record指针为nullptr", "trigger_path": "调用路径推导：外部调用 -> OH_HiSysEvent_GetParam*() -> GetParam*()。数据流：record指针可能来自外部输入，直接传递给OH_HiSysEvent_GetParam*()函数，这些函数内部直接解引用record指针而未做空指针检查。关键调用点：所有OH_HiSysEvent_GetParam*()函数均未对record指针进行空指针验证。", "consequences": "空指针解引用，导致程序崩溃", "suggestions": "在所有OH_HiSysEvent_GetParam*()函数入口处添加对record指针的非空检查，并在指针为null时返回错误码", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/native/innerkits/hisysevent_manager/hisysevent_record_c.cpp", "line": 191, "evidence": "return GetParamStringValues(*record, name, value, *len);", "confidence": 0.6, "severity": "high", "gid": 377, "verify": "检查指针在解引用前是否经过非空验证（record指针）", "has_risk": true, "preconditions": "record指针为nullptr", "trigger_path": "调用路径推导：外部调用 -> OH_HiSysEvent_GetParam*() -> GetParam*()。数据流：record指针可能来自外部输入，直接传递给OH_HiSysEvent_GetParam*()函数，这些函数内部直接解引用record指针而未做空指针检查。关键调用点：所有OH_HiSysEvent_GetParam*()函数均未对record指针进行空指针验证。", "consequences": "空指针解引用，导致程序崩溃", "suggestions": "在所有OH_HiSysEvent_GetParam*()函数入口处添加对record指针的非空检查，并在指针为null时返回错误码", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/native/innerkits/hisysevent_manager/hisysevent_record_c.cpp", "line": 191, "evidence": "return GetParamStringValues(*record, name, value, *len);", "confidence": 0.6, "severity": "high", "gid": 378, "verify": "检查指针在解引用前是否经过非空验证（record指针）", "has_risk": true, "preconditions": "record指针为nullptr", "trigger_path": "调用路径推导：外部调用 -> OH_HiSysEvent_GetParam*() -> GetParam*()。数据流：record指针可能来自外部输入，直接传递给OH_HiSysEvent_GetParam*()函数，这些函数内部直接解引用record指针而未做空指针检查。关键调用点：所有OH_HiSysEvent_GetParam*()函数均未对record指针进行空指针验证。", "consequences": "空指针解引用，导致程序崩溃", "suggestions": "在所有OH_HiSysEvent_GetParam*()函数入口处添加对record指针的非空检查，并在指针为null时返回错误码", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "c/cpp", "category": "type_safety", "pattern": "reinterpret_cast_unsafe", "file": "interfaces/native/innerkits/hisysevent/event_socket_factory.cpp", "line": 106, "evidence": "struct HiSysEventHeader header = *(reinterpret_cast<struct HiSysEventHeader*>(originalData + sizeof(int32_t)));", "confidence": 0.7999999999999999, "severity": "high", "gid": 475, "verify": "验证候选 475 的安全风险", "has_risk": true, "preconditions": "原始数据长度足够(sizeof(int32_t) + sizeof(HiSysEventHeader))但未正确对齐或内容无效", "trigger_path": "调用路径推导：EventSocketFactory::GetEventSocket() -> ParseEventInfo() -> reinterpret_cast转换。数据流：RawData对象通过GetEventSocket()接收，传递给ParseEventInfo()解析，ParseEventInfo()检查了数据长度但未验证对齐和内容，直接使用reinterpret_cast转换指针。关键调用点：ParseEventInfo()函数未对指针对齐和结构内容进行校验。", "consequences": "内存访问错误或未定义行为，可能导致程序崩溃或信息泄露", "suggestions": "1. 添加指针对齐检查；2. 使用memcpy代替指针转换；3. 验证结构体字段有效性（如字符串null终止符）", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "c/cpp", "category": "error_handling", "pattern": "io_call", "file": "interfaces/native/innerkits/hisysevent/hisysevent_c.cpp", "line": 36, "evidence": "return HiSysEvent::Write(func, line, domain, name, HiSysEvent::EventType(type), params, size);", "confidence": 0.65, "severity": "medium", "gid": 476, "verify": "验证候选 476 的安全风险", "has_risk": true, "preconditions": "传入的HiSysEventParam结构体中的字符串指针(s)或数组指针(array)为nullptr，且arraySize参数超出合理范围", "trigger_path": "调用路径推导：HiSysEvent_Write() -> HiSysEventInnerWrite() -> HiSysEvent::Write() -> HiSysEvent::InnerWrite()。数据流：外部输入通过HiSysEvent_Write接收，传递到HiSysEvent::InnerWrite处理。关键调用点：HiSysEvent::InnerWrite未检查HiSysEventParam结构体中的字符串指针和数组指针是否为nullptr，也未验证arraySize参数的合理性。", "consequences": "可能导致空指针解引用或数组越界访问，引发程序崩溃或内存破坏", "suggestions": "1. 在HiSysEvent::InnerWrite中添加对HiSysEventParam结构体中指针的null检查；2. 添加对arraySize参数的边界检查；3. 对字符串参数使用安全处理函数", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/js/kits/napi/src/napi_hisysevent_querier.cpp", "line": 46, "evidence": "jsCallbackManager->Release();", "confidence": 0.6, "severity": "high", "gid": 533, "verify": "验证指针jsCallbackManager和callbackContext在解引用前非空", "has_risk": true, "preconditions": "callbackContext指针为空", "trigger_path": "调用路径推导：NapiHiSysEventQuerier构造函数 -> 析构函数/OnQuery/OnComplete方法。数据流：callbackContext通过构造函数参数传入，但在析构函数和成员方法中使用前未进行判空检查。关键调用点：NapiHiSysEventQuerier构造函数未对callbackContext参数进行非空校验。", "consequences": "空指针解引用导致程序崩溃", "suggestions": "1. 在构造函数中添加callbackContext参数的非空校验；2. 在所有使用callbackContext的成员方法中添加判空检查", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/js/kits/napi/src/napi_hisysevent_querier.cpp", "line": 48, "evidence": "if (callbackContext->threadId == getproctid()) {", "confidence": 0.6, "severity": "high", "gid": 534, "verify": "验证指针jsCallbackManager和callbackContext在解引用前非空", "has_risk": true, "preconditions": "callbackContext指针为空", "trigger_path": "调用路径推导：NapiHiSysEventQuerier构造函数 -> 析构函数/OnQuery/OnComplete方法。数据流：callbackContext通过构造函数参数传入，但在析构函数和成员方法中使用前未进行判空检查。关键调用点：NapiHiSysEventQuerier构造函数未对callbackContext参数进行非空校验。", "consequences": "空指针解引用导致程序崩溃", "suggestions": "1. 在构造函数中添加callbackContext参数的非空校验；2. 在所有使用callbackContext的成员方法中添加判空检查", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/js/kits/napi/src/napi_hisysevent_querier.cpp", "line": 49, "evidence": "napi_delete_reference(callbackContext->env, callbackContext->ref);", "confidence": 0.6, "severity": "high", "gid": 535, "verify": "验证指针jsCallbackManager和callbackContext在解引用前非空", "has_risk": true, "preconditions": "callbackContext指针为空", "trigger_path": "调用路径推导：NapiHiSysEventQuerier构造函数 -> 析构函数/OnQuery/OnComplete方法。数据流：callbackContext通过构造函数参数传入，但在析构函数和成员方法中使用前未进行判空检查。关键调用点：NapiHiSysEventQuerier构造函数未对callbackContext参数进行非空校验。", "consequences": "空指针解引用导致程序崩溃", "suggestions": "1. 在构造函数中添加callbackContext参数的非空校验；2. 在所有使用callbackContext的成员方法中添加判空检查", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/js/kits/napi/src/napi_hisysevent_querier.cpp", "line": 57, "evidence": "jsCallbackManager->Add(callbackContext,", "confidence": 0.6, "severity": "high", "gid": 536, "verify": "验证指针jsCallbackManager和callbackContext在解引用前非空", "has_risk": true, "preconditions": "callbackContext指针为空", "trigger_path": "调用路径推导：NapiHiSysEventQuerier构造函数 -> 析构函数/OnQuery/OnComplete方法。数据流：callbackContext通过构造函数参数传入，但在析构函数和成员方法中使用前未进行判空检查。关键调用点：NapiHiSysEventQuerier构造函数未对callbackContext参数进行非空校验。", "consequences": "空指针解引用导致程序崩溃", "suggestions": "1. 在构造函数中添加callbackContext参数的非空校验；2. 在所有使用callbackContext的成员方法中添加判空检查", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/js/kits/napi/src/napi_hisysevent_querier.cpp", "line": 80, "evidence": "jsCallbackManager->Add(callbackContext,", "confidence": 0.6, "severity": "high", "gid": 537, "verify": "验证指针jsCallbackManager和callbackContext在解引用前非空", "has_risk": true, "preconditions": "callbackContext指针为空", "trigger_path": "调用路径推导：NapiHiSysEventQuerier构造函数 -> 析构函数/OnQuery/OnComplete方法。数据流：callbackContext通过构造函数参数传入，但在析构函数和成员方法中使用前未进行判空检查。关键调用点：NapiHiSysEventQuerier构造函数未对callbackContext参数进行非空校验。", "consequences": "空指针解引用导致程序崩溃", "suggestions": "1. 在构造函数中添加callbackContext参数的非空校验；2. 在所有使用callbackContext的成员方法中添加判空检查", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/js/kits/napi/src/napi_hisysevent_querier.cpp", "line": 106, "evidence": "this->onCompleteHandler(this->callbackContext->env, this->callbackContext->ref);", "confidence": 0.6, "severity": "high", "gid": 538, "verify": "验证指针jsCallbackManager和callbackContext在解引用前非空", "has_risk": true, "preconditions": "callbackContext指针为空", "trigger_path": "调用路径推导：NapiHiSysEventQuerier构造函数 -> 析构函数/OnQuery/OnComplete方法。数据流：callbackContext通过构造函数参数传入，但在析构函数和成员方法中使用前未进行判空检查。关键调用点：NapiHiSysEventQuerier构造函数未对callbackContext参数进行非空校验。", "consequences": "空指针解引用导致程序崩溃", "suggestions": "1. 在构造函数中添加callbackContext参数的非空校验；2. 在所有使用callbackContext的成员方法中添加判空检查", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/js/kits/napi/src/napi_hisysevent_listener.cpp", "line": 47, "evidence": "if (callbackContext->threadId == getproctid()) {", "confidence": 0.6, "severity": "high", "gid": 556, "verify": "callbackContext pointer is not null before dereference", "has_risk": true, "preconditions": "callbackContext指针被意外修改为nullptr或析构函数被异常调用", "trigger_path": "调用路径推导：AddWatcher() -> std::make_shared<NapiHiSysEventListener>() -> ~NapiHiSysEventListener()。数据流：callbackContext在AddWatcher函数中通过new创建并初始化，传递给NapiHiSysEventListener构造函数，存储在成员变量中。在析构函数中直接解引用callbackContext而未检查空指针。关键调用点：析构函数未对callbackContext进行空指针检查。", "consequences": "空指针解引用导致程序崩溃", "suggestions": "在析构函数中对callbackContext添加空指针检查，例如：if (callbackContext != nullptr) {...}", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "possible_null_deref", "file": "interfaces/js/kits/napi/src/napi_hisysevent_listener.cpp", "line": 48, "evidence": "napi_delete_reference(callbackContext->env, callbackContext->ref);", "confidence": 0.6, "severity": "high", "gid": 557, "verify": "callbackContext pointer is not null before dereference", "has_risk": true, "preconditions": "callbackContext指针被意外修改为nullptr或析构函数被异常调用", "trigger_path": "调用路径推导：AddWatcher() -> std::make_shared<NapiHiSysEventListener>() -> ~NapiHiSysEventListener()。数据流：callbackContext在AddWatcher函数中通过new创建并初始化，传递给NapiHiSysEventListener构造函数，存储在成员变量中。在析构函数中直接解引用callbackContext而未检查空指针。关键调用点：析构函数未对callbackContext进行空指针检查。", "consequences": "空指针解引用导致程序崩溃", "suggestions": "在析构函数中对callbackContext添加空指针检查，例如：if (callbackContext != nullptr) {...}", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "alloc_no_null_check", "file": "interfaces/js/kits/napi/src/napi_hisysevent_js.cpp", "line": 144, "evidence": "CallbackContext* callbackContext = new CallbackContext();", "confidence": 0.8, "severity": "high", "gid": 593, "verify": "验证内存分配操作后是否都有null检查", "has_risk": true, "preconditions": "内存分配失败", "trigger_path": "调用路径推导：Write()/AddWatcher()/Query() -> new 操作。数据流：直接调用 new 分配内存。关键调用点：AddWatcher() 和 Query() 函数未对 new 操作结果进行 null 检查", "consequences": "内存分配失败导致空指针解引用，可能引发程序崩溃", "suggestions": "1. 使用 new(std::nothrow) 替代 new 2. 添加 null 检查逻辑", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "c/cpp", "category": "memory_mgmt", "pattern": "alloc_no_null_check", "file": "interfaces/js/kits/napi/src/napi_hisysevent_js.cpp", "line": 232, "evidence": "CallbackContext* callbackContext = new CallbackContext();", "confidence": 0.8, "severity": "high", "gid": 594, "verify": "验证内存分配操作后是否都有null检查", "has_risk": true, "preconditions": "内存分配失败", "trigger_path": "调用路径推导：Write()/AddWatcher()/Query() -> new 操作。数据流：直接调用 new 分配内存。关键调用点：AddWatcher() 和 Query() 函数未对 new 操作结果进行 null 检查", "consequences": "内存分配失败导致空指针解引用，可能引发程序崩溃", "suggestions": "1. 使用 new(std::nothrow) 替代 new 2. 添加 null 检查逻辑", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "rust", "category": "unsafe_usage", "pattern": "unsafe", "file": "interfaces/rust/innerkits/src/sys_event_manager.rs", "line": 212, "evidence": "let level_arr = unsafe {", "confidence": 0.8, "severity": "high", "gid": 621, "verify": "验证从原始指针转换CString时指针非空且指向有效的C字符串", "has_risk": true, "preconditions": "self.level, self.tag 或 self.json_str 指针为空或指向无效的C字符串", "trigger_path": "调用路径推导：外部调用 -> get_level()/get_tag()/get_json_str() -> unsafe CString::from_raw。数据流：原始指针通过结构体字段传递到方法中，方法直接使用unsafe块转换指针为CString，未进行有效性检查。关键调用点：get_level()/get_tag()/get_json_str()方法未对原始指针进行有效性验证。", "consequences": "可能导致未定义行为，包括程序崩溃或内存安全问题", "suggestions": "1. 在调用CString::from_raw前验证指针非空；2. 确保指针指向有效的以null结尾的C字符串；3. 考虑使用Option<*mut c_char>类型明确表示可能为空的指针", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "rust", "category": "unsafe_usage", "pattern": "unsafe", "file": "interfaces/rust/innerkits/src/sys_event_manager.rs", "line": 221, "evidence": "let tag_arr = unsafe {", "confidence": 0.8, "severity": "high", "gid": 622, "verify": "验证从原始指针转换CString时指针非空且指向有效的C字符串", "has_risk": true, "preconditions": "self.level, self.tag 或 self.json_str 指针为空或指向无效的C字符串", "trigger_path": "调用路径推导：外部调用 -> get_level()/get_tag()/get_json_str() -> unsafe CString::from_raw。数据流：原始指针通过结构体字段传递到方法中，方法直接使用unsafe块转换指针为CString，未进行有效性检查。关键调用点：get_level()/get_tag()/get_json_str()方法未对原始指针进行有效性验证。", "consequences": "可能导致未定义行为，包括程序崩溃或内存安全问题", "suggestions": "1. 在调用CString::from_raw前验证指针非空；2. 确保指针指向有效的以null结尾的C字符串；3. 考虑使用Option<*mut c_char>类型明确表示可能为空的指针", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "rust", "category": "unsafe_usage", "pattern": "unsafe", "file": "interfaces/rust/innerkits/src/sys_event_manager.rs", "line": 231, "evidence": "let json_str_arr = unsafe {", "confidence": 0.8, "severity": "high", "gid": 623, "verify": "验证从原始指针转换CString时指针非空且指向有效的C字符串", "has_risk": true, "preconditions": "self.level, self.tag 或 self.json_str 指针为空或指向无效的C字符串", "trigger_path": "调用路径推导：外部调用 -> get_level()/get_tag()/get_json_str() -> unsafe CString::from_raw。数据流：原始指针通过结构体字段传递到方法中，方法直接使用unsafe块转换指针为CString，未进行有效性检查。关键调用点：get_level()/get_tag()/get_json_str()方法未对原始指针进行有效性验证。", "consequences": "可能导致未定义行为，包括程序崩溃或内存安全问题", "suggestions": "1. 在调用CString::from_raw前验证指针非空；2. 确保指针指向有效的以null结尾的C字符串；3. 考虑使用Option<*mut c_char>类型明确表示可能为空的指针", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "rust", "category": "unsafe_usage", "pattern": "raw_pointer", "file": "interfaces/rust/innerkits/src/sys_event_manager.rs", "line": 213, "evidence": "std::ffi::CString::from_raw(self.level as *mut std::ffi::c_char)", "confidence": 0.75, "severity": "medium", "gid": 644, "verify": "验证从原始指针转换CString时指针非空且指向有效的C字符串", "has_risk": true, "preconditions": "self.level, self.tag 或 self.json_str 指针为空或指向无效的C字符串", "trigger_path": "调用路径推导：外部调用 -> get_level()/get_tag()/get_json_str() -> unsafe CString::from_raw。数据流：原始指针通过结构体字段传递到方法中，方法直接使用unsafe块转换指针为CString，未进行有效性检查。关键调用点：get_level()/get_tag()/get_json_str()方法未对原始指针进行有效性验证。", "consequences": "可能导致未定义行为，包括程序崩溃或内存安全问题", "suggestions": "1. 在调用CString::from_raw前验证指针非空；2. 确保指针指向有效的以null结尾的C字符串；3. 考虑使用Option<*mut c_char>类型明确表示可能为空的指针", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "rust", "category": "unsafe_usage", "pattern": "raw_pointer", "file": "interfaces/rust/innerkits/src/sys_event_manager.rs", "line": 222, "evidence": "std::ffi::CString::from_raw(self.tag as *mut std::ffi::c_char)", "confidence": 0.75, "severity": "medium", "gid": 645, "verify": "验证从原始指针转换CString时指针非空且指向有效的C字符串", "has_risk": true, "preconditions": "self.level, self.tag 或 self.json_str 指针为空或指向无效的C字符串", "trigger_path": "调用路径推导：外部调用 -> get_level()/get_tag()/get_json_str() -> unsafe CString::from_raw。数据流：原始指针通过结构体字段传递到方法中，方法直接使用unsafe块转换指针为CString，未进行有效性检查。关键调用点：get_level()/get_tag()/get_json_str()方法未对原始指针进行有效性验证。", "consequences": "可能导致未定义行为，包括程序崩溃或内存安全问题", "suggestions": "1. 在调用CString::from_raw前验证指针非空；2. 确保指针指向有效的以null结尾的C字符串；3. 考虑使用Option<*mut c_char>类型明确表示可能为空的指针", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "rust", "category": "unsafe_usage", "pattern": "raw_pointer", "file": "interfaces/rust/innerkits/src/sys_event_manager.rs", "line": 232, "evidence": "std::ffi::CString::from_raw(self.json_str as *mut std::ffi::c_char)", "confidence": 0.75, "severity": "medium", "gid": 646, "verify": "验证从原始指针转换CString时指针非空且指向有效的C字符串", "has_risk": true, "preconditions": "self.level, self.tag 或 self.json_str 指针为空或指向无效的C字符串", "trigger_path": "调用路径推导：外部调用 -> get_level()/get_tag()/get_json_str() -> unsafe CString::from_raw。数据流：原始指针通过结构体字段传递到方法中，方法直接使用unsafe块转换指针为CString，未进行有效性检查。关键调用点：get_level()/get_tag()/get_json_str()方法未对原始指针进行有效性验证。", "consequences": "可能导致未定义行为，包括程序崩溃或内存安全问题", "suggestions": "1. 在调用CString::from_raw前验证指针非空；2. 确保指针指向有效的以null结尾的C字符串；3. 考虑使用Option<*mut c_char>类型明确表示可能为空的指针", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "rust", "category": "error_handling", "pattern": "unwrap/expect", "file": "interfaces/rust/innerkits/src/sys_event_manager.rs", "line": 143, "evidence": "std::str::from_utf8(&self.domain).expect(\"                       \")", "confidence": 0.65, "severity": "medium", "gid": 695, "verify": "验证unwrap/expect调用前是否有错误处理或确保不会panic", "has_risk": true, "preconditions": "输入的字节数组包含非UTF-8编码数据", "trigger_path": "调用路径推导：外部输入 -> HiSysEventRecord结构体初始化 -> get_domain()/get_event_name()/get_time_zone() -> std::str::from_utf8().expect()。数据流：外部输入直接填充到HiSysEventRecord的domain/event_name/tz数组字段，调用getter方法时未验证UTF-8有效性直接转换。关键调用点：所有getter方法都未对字节数组进行UTF-8有效性校验。", "consequences": "当输入包含无效UTF-8序列时会导致panic，可能造成服务中断", "suggestions": "使用from_utf8_lossy()替代expect()，或在使用前验证UTF-8有效性", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "rust", "category": "error_handling", "pattern": "unwrap/expect", "file": "interfaces/rust/innerkits/src/sys_event_manager.rs", "line": 149, "evidence": "std::str::from_utf8(&self.event_name).expect(\"                           \")", "confidence": 0.65, "severity": "medium", "gid": 696, "verify": "验证unwrap/expect调用前是否有错误处理或确保不会panic", "has_risk": true, "preconditions": "输入的字节数组包含非UTF-8编码数据", "trigger_path": "调用路径推导：外部输入 -> HiSysEventRecord结构体初始化 -> get_domain()/get_event_name()/get_time_zone() -> std::str::from_utf8().expect()。数据流：外部输入直接填充到HiSysEventRecord的domain/event_name/tz数组字段，调用getter方法时未验证UTF-8有效性直接转换。关键调用点：所有getter方法都未对字节数组进行UTF-8有效性校验。", "consequences": "当输入包含无效UTF-8序列时会导致panic，可能造成服务中断", "suggestions": "使用from_utf8_lossy()替代expect()，或在使用前验证UTF-8有效性", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "rust", "category": "error_handling", "pattern": "unwrap/expect", "file": "interfaces/rust/innerkits/src/sys_event_manager.rs", "line": 171, "evidence": "std::str::from_utf8(&self.tz).expect(\"                          \")", "confidence": 0.65, "severity": "medium", "gid": 697, "verify": "验证unwrap/expect调用前是否有错误处理或确保不会panic", "has_risk": true, "preconditions": "输入的字节数组包含非UTF-8编码数据", "trigger_path": "调用路径推导：外部输入 -> HiSysEventRecord结构体初始化 -> get_domain()/get_event_name()/get_time_zone() -> std::str::from_utf8().expect()。数据流：外部输入直接填充到HiSysEventRecord的domain/event_name/tz数组字段，调用getter方法时未验证UTF-8有效性直接转换。关键调用点：所有getter方法都未对字节数组进行UTF-8有效性校验。", "consequences": "当输入包含无效UTF-8序列时会导致panic，可能造成服务中断", "suggestions": "使用from_utf8_lossy()替代expect()，或在使用前验证UTF-8有效性", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "rust", "category": "error_handling", "pattern": "unwrap/expect", "file": "interfaces/rust/innerkits/src/sys_event_manager.rs", "line": 215, "evidence": "std::str::from_utf8(level_arr.to_bytes()).expect(\"                        \")", "confidence": 0.65, "severity": "medium", "gid": 698, "verify": "验证unwrap/expect调用前是否有错误处理或确保不会panic", "has_risk": true, "preconditions": "从C指针转换的字符串包含非UTF-8编码数据或空指针", "trigger_path": "调用路径推导：C层输入 -> HiSysEventRecord结构体初始化 -> get_level()/get_tag()/get_json_str() -> std::str::from_utf8().expect()。数据流：C指针通过FFI传递给Rust层，在getter方法中未验证指针有效性直接转换。关键调用点：unsafe块中未对CString::from_raw的结果进行有效性检查。", "consequences": "当C层传入无效指针或非UTF-8数据时会导致panic，可能造成服务中断", "suggestions": "添加指针非空检查，使用from_utf8_lossy()替代expect()，或在使用前验证UTF-8有效性", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "rust", "category": "error_handling", "pattern": "unwrap/expect", "file": "interfaces/rust/innerkits/src/sys_event_manager.rs", "line": 224, "evidence": "let tag = std::str::from_utf8(tag_arr.to_bytes()).expect(\"                      \")", "confidence": 0.65, "severity": "medium", "gid": 699, "verify": "验证unwrap/expect调用前是否有错误处理或确保不会panic", "has_risk": true, "preconditions": "从C指针转换的字符串包含非UTF-8编码数据或空指针", "trigger_path": "调用路径推导：C层输入 -> HiSysEventRecord结构体初始化 -> get_level()/get_tag()/get_json_str() -> std::str::from_utf8().expect()。数据流：C指针通过FFI传递给Rust层，在getter方法中未验证指针有效性直接转换。关键调用点：unsafe块中未对CString::from_raw的结果进行有效性检查。", "consequences": "当C层传入无效指针或非UTF-8数据时会导致panic，可能造成服务中断", "suggestions": "添加指针非空检查，使用from_utf8_lossy()替代expect()，或在使用前验证UTF-8有效性", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "rust", "category": "error_handling", "pattern": "unwrap/expect", "file": "interfaces/rust/innerkits/src/sys_event_manager.rs", "line": 234, "evidence": "let json_str = std::str::from_utf8(json_str_arr.to_bytes()).expect(\"                           \")", "confidence": 0.65, "severity": "medium", "gid": 700, "verify": "验证unwrap/expect调用前是否有错误处理或确保不会panic", "has_risk": true, "preconditions": "从C指针转换的字符串包含非UTF-8编码数据或空指针", "trigger_path": "调用路径推导：C层输入 -> HiSysEventRecord结构体初始化 -> get_level()/get_tag()/get_json_str() -> std::str::from_utf8().expect()。数据流：C指针通过FFI传递给Rust层，在getter方法中未验证指针有效性直接转换。关键调用点：unsafe块中未对CString::from_raw的结果进行有效性检查。", "consequences": "当C层传入无效指针或非UTF-8数据时会导致panic，可能造成服务中断", "suggestions": "添加指针非空检查，使用from_utf8_lossy()替代expect()，或在使用前验证UTF-8有效性", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "rust", "category": "error_handling", "pattern": "unwrap/expect", "file": "interfaces/rust/innerkits/src/sys_event_manager.rs", "line": 373, "evidence": "let condition_wrapper = CString::new(query_rules[i].condition).expect(\"                           \");", "confidence": 0.65, "severity": "medium", "gid": 702, "verify": "验证unwrap/expect调用前是否有错误处理或确保不会panic", "has_risk": true, "preconditions": "query_rules[i].condition包含null字节", "trigger_path": "调用路径推导：外部输入 -> query() -> CString::new().expect()。数据流：外部输入的查询条件字符串直接用于创建CString。关键调用点：未检查输入字符串是否包含null字节。", "consequences": "当条件字符串包含null字节时会导致panic，可能造成查询失败", "suggestions": "使用CString::new().unwrap_or_default()或过滤掉null字节", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "rust", "category": "ffi", "pattern": "CString/CStr", "file": "interfaces/rust/innerkits/src/sys_event_manager.rs", "line": 213, "evidence": "std::ffi::CString::from_raw(self.level as *mut std::ffi::c_char)", "confidence": 0.65, "severity": "medium", "gid": 705, "verify": "验证C字符串转换是否安全", "has_risk": true, "preconditions": "传入的C指针不是有效的、以null结尾的C字符串，或者指针为null", "trigger_path": "调用路径推导：C代码 -> 创建HiSysEventRecord -> Rust调用get_level/get_tag/get_json_str -> from_raw转换。数据流：C代码传入原始指针到HiSysEventRecord结构体，Rust方法直接使用from_raw转换这些指针。关键调用点：所有方法都未对指针进行有效性检查。", "consequences": "可能导致未定义行为、程序崩溃或内存安全问题", "suggestions": "1) 在转换前检查指针是否为null；2) 确保C端保证传入的字符串是有效的、以null结尾的；3) 考虑使用CStr而不是CString来避免所有权问题", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "rust", "category": "ffi", "pattern": "CString/CStr", "file": "interfaces/rust/innerkits/src/sys_event_manager.rs", "line": 222, "evidence": "std::ffi::CString::from_raw(self.tag as *mut std::ffi::c_char)", "confidence": 0.65, "severity": "medium", "gid": 706, "verify": "验证C字符串转换是否安全", "has_risk": true, "preconditions": "传入的C指针不是有效的、以null结尾的C字符串，或者指针为null", "trigger_path": "调用路径推导：C代码 -> 创建HiSysEventRecord -> Rust调用get_level/get_tag/get_json_str -> from_raw转换。数据流：C代码传入原始指针到HiSysEventRecord结构体，Rust方法直接使用from_raw转换这些指针。关键调用点：所有方法都未对指针进行有效性检查。", "consequences": "可能导致未定义行为、程序崩溃或内存安全问题", "suggestions": "1) 在转换前检查指针是否为null；2) 确保C端保证传入的字符串是有效的、以null结尾的；3) 考虑使用CStr而不是CString来避免所有权问题", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "rust", "category": "ffi", "pattern": "CString/CStr", "file": "interfaces/rust/innerkits/src/sys_event_manager.rs", "line": 232, "evidence": "std::ffi::CString::from_raw(self.json_str as *mut std::ffi::c_char)", "confidence": 0.65, "severity": "medium", "gid": 707, "verify": "验证C字符串转换是否安全", "has_risk": true, "preconditions": "传入的C指针不是有效的、以null结尾的C字符串，或者指针为null", "trigger_path": "调用路径推导：C代码 -> 创建HiSysEventRecord -> Rust调用get_level/get_tag/get_json_str -> from_raw转换。数据流：C代码传入原始指针到HiSysEventRecord结构体，Rust方法直接使用from_raw转换这些指针。关键调用点：所有方法都未对指针进行有效性检查。", "consequences": "可能导致未定义行为、程序崩溃或内存安全问题", "suggestions": "1) 在转换前检查指针是否为null；2) 确保C端保证传入的字符串是有效的、以null结尾的；3) 考虑使用CStr而不是CString来避免所有权问题", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "rust", "category": "unsafe_usage", "pattern": "from_raw_parts/from_raw", "file": "interfaces/rust/innerkits/src/sys_event_manager.rs", "line": 213, "evidence": "std::ffi::CString::from_raw(self.level as *mut std::ffi::c_char)", "confidence": 0.85, "severity": "high", "gid": 708, "verify": "验证from_raw调用是否安全（指针来源是否可靠）", "has_risk": true, "preconditions": "C/C++端传入的level/tag/json_str指针无效或未正确分配", "trigger_path": "调用路径推导：C/C++代码 -> GetHiSysEventRecordByIndexWrapper() -> Rust代码 -> get_level()/get_tag()/get_json_str() -> CString::from_raw()。数据流：C/C++端创建HiSysEventRecord并设置指针字段，通过FFI传递给Rust端，Rust直接使用from_raw转换这些指针。关键调用点：Rust端未对指针进行有效性验证，也未明确指针所有权。", "consequences": "可能导致空指针解引用、访问无效内存、双重释放或内存泄漏", "suggestions": "1. 在Rust端添加指针有效性检查；2. 明确指针所有权协议；3. 考虑使用更安全的FFI包装器或自动生成绑定", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "rust", "category": "unsafe_usage", "pattern": "from_raw_parts/from_raw", "file": "interfaces/rust/innerkits/src/sys_event_manager.rs", "line": 222, "evidence": "std::ffi::CString::from_raw(self.tag as *mut std::ffi::c_char)", "confidence": 0.85, "severity": "high", "gid": 709, "verify": "验证from_raw调用是否安全（指针来源是否可靠）", "has_risk": true, "preconditions": "C/C++端传入的level/tag/json_str指针无效或未正确分配", "trigger_path": "调用路径推导：C/C++代码 -> GetHiSysEventRecordByIndexWrapper() -> Rust代码 -> get_level()/get_tag()/get_json_str() -> CString::from_raw()。数据流：C/C++端创建HiSysEventRecord并设置指针字段，通过FFI传递给Rust端，Rust直接使用from_raw转换这些指针。关键调用点：Rust端未对指针进行有效性验证，也未明确指针所有权。", "consequences": "可能导致空指针解引用、访问无效内存、双重释放或内存泄漏", "suggestions": "1. 在Rust端添加指针有效性检查；2. 明确指针所有权协议；3. 考虑使用更安全的FFI包装器或自动生成绑定", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "rust", "category": "unsafe_usage", "pattern": "from_raw_parts/from_raw", "file": "interfaces/rust/innerkits/src/sys_event_manager.rs", "line": 232, "evidence": "std::ffi::CString::from_raw(self.json_str as *mut std::ffi::c_char)", "confidence": 0.85, "severity": "high", "gid": 710, "verify": "验证from_raw调用是否安全（指针来源是否可靠）", "has_risk": true, "preconditions": "C/C++端传入的level/tag/json_str指针无效或未正确分配", "trigger_path": "调用路径推导：C/C++代码 -> GetHiSysEventRecordByIndexWrapper() -> Rust代码 -> get_level()/get_tag()/get_json_str() -> CString::from_raw()。数据流：C/C++端创建HiSysEventRecord并设置指针字段，通过FFI传递给Rust端，Rust直接使用from_raw转换这些指针。关键调用点：Rust端未对指针进行有效性验证，也未明确指针所有权。", "consequences": "可能导致空指针解引用、访问无效内存、双重释放或内存泄漏", "suggestions": "1. 在Rust端添加指针有效性检查；2. 明确指针所有权协议；3. 考虑使用更安全的FFI包装器或自动生成绑定", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "rust", "category": "ffi", "pattern": "CString/CStr", "file": "interfaces/rust/innerkits/src/utils.rs", "line": 20, "evidence": "let name = CString::new(src).unwrap();", "confidence": 0.65, "severity": "medium", "gid": 716, "verify": "验证所有FFI操作是否正确处理了内存管理和类型转换", "has_risk": true, "preconditions": "输入字符串长度超过目标缓冲区大小", "trigger_path": "调用路径推导：sys_event_manager.rs中的HiSysEvent查询/写入函数 -> trans_slice_to_array()。数据流：查询/写入参数通过FFI接口传入，在sys_event_manager.rs中部分调用点进行了长度校验(line 382-387)，但sys_event.rs中的调用点未直接校验输入长度。关键调用点：sys_event.rs中的write函数未对event_params[i].param_name长度进行校验。", "consequences": "可能导致缓冲区溢出或数据截断", "suggestions": "1. 在trans_slice_to_array函数中添加输入长度校验 2. 使用expect替代unwrap提供更有意义的错误信息 3. 确保所有调用点都进行输入长度校验", "verification_notes": "未进行二次验证（--no-verification）"}
{"language": "rust", "category": "error_handling", "pattern": "unwrap/expect", "file": "interfaces/rust/innerkits/src/utils.rs", "line": 20, "evidence": "let name = CString::new(src).unwrap();", "confidence": 0.65, "severity": "medium", "gid": 713, "verify": "验证所有错误处理是否合理，是否有潜在的错误被忽略", "has_risk": true, "preconditions": "输入字符串 src 包含空字节(null byte)", "trigger_path": "调用路径推导：外部调用者 -> trans_slice_to_array() -> CString::new().unwrap()。数据流：外部传入的字符串src直接传递给CString::new()，未进行空字节检查。关键调用点：trans_slice_to_array()函数未对输入进行空字节校验。", "consequences": "程序panic，可能导致服务中断", "suggestions": "使用expect提供更有意义的错误信息，或使用match/Result进行显式错误处理", "verification_notes": "未进行二次验证（--no-verification）"}
