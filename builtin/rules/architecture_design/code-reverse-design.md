# 代码反向设计规则

代码反向设计规则用于指导如何从现有代码中提取设计信息并生成语言无关的设计方案，确保新实现能够完整对齐原代码功能。

## 你必须遵循的工作流程

### 1. 代码阅读与理解阶段

- **使用工具**：使用read_code工具读取并分析给定的代码文件
- **架构识别**：识别代码的整体架构、主要模块和核心类/函数
- **关系理解**：理解各组件之间的调用关系和依赖关系

### 2. 功能要素提取阶段

- **功能提取**：提取代码实现的核心业务功能
- **流程分析**：识别数据处理流程和算法逻辑
- **接口分析**：分析输入输出接口和数据结构
- **配置总结**：总结配置参数和环境依赖

### 3. 设计方案构建阶段

- **语言无关设计**：基于功能分析，构建语言无关的设计方案
- **模块定义**：定义模块划分和职责边界
- **算法描述**：描述核心算法和业务规则
- **流程明确**：明确数据流和控制流

### 4. 验证与确认阶段

- **完整性检查**：检查设计方案是否完整覆盖了原代码的所有功能
- **可实现性确认**：确保设计方案的可实现性和可测试性
- **建议提供**：提供实现建议和注意事项

## 你必须遵守的原则

### 完整性原则

- **必须**：确保设计方案覆盖原代码的所有功能点
- **禁止**：遗漏任何功能或业务逻辑
- **必须**：提供功能对照表验证完整性

### 可实现性原则

- **必须**：设计方案必须具有实际可实施性
- **必须**：提供明确的技术选型建议
- **必须**：包含实现指导和注意事项

### 语言无关性原则

- **必须**：设计方案不包含具体编程语言语法
- **必须**：使用通用的设计概念和术语
- **必须**：避免语言特定的实现细节

### 清晰性原则

- **必须**：使用清晰、准确的语言描述设计要素
- **必须**：提供具体的示例和说明
- **必须**：保持设计原则和风格的一致性

## 具体要求和规范

### 架构设计规范

#### 1. 整体架构要求

- **必须**：描述系统的整体架构模式和设计理念
- **必须**：明确定义各个模块的职责和边界
- **必须**：描述组件间的调用关系和依赖关系
- **必须**：说明数据在系统中的流动路径

#### 2. 功能设计规范

- **必须**：列出系统实现的所有核心功能点
- **必须**：详细描述业务逻辑和规则
- **必须**：说明关键算法的原理和步骤
- **必须**：定义异常情况的处理机制

#### 3. 接口设计要求

- **必须**：定义系统接收的输入数据和格式
- **必须**：定义系统产生的输出数据和格式
- **必须**：说明配置参数和环境要求
- **必须**：描述系统的扩展点和插件机制

#### 4. 实现指导规范

- **必须**：提供合适的技术栈建议
- **必须**：建议的开发优先级和步骤
- **必须**：指出需要重点测试的功能点
- **必须**：列出实现过程中需要特别注意的问题

## 输出格式要求

请严格按照以下格式输出完整的设计方案：

```markdown
### 代码反构设计方案

**1. 项目概述**

- **代码功能**：简要描述原代码实现的核心功能
- **设计目标**：说明开发需要达到的目标和要求

**2. 架构设计**

**2.1 整体架构**

- **架构模式**：采用的架构模式（如分层架构、微服务架构等）
- **设计原则**：遵循的核心设计原则和理念

**2.2 模块设计**

- **模块A**：模块名称和职责描述
  - **核心职责**：该模块主要负责的功能
  - **输入输出**：接收的输入和产生的输出
  - **依赖关系**：依赖的其他模块或外部服务

- **模块B**：模块名称和职责描述
  - **核心职责**：该模块主要负责的功能
  - **输入输出**：接收的输入和产生的输出
  - **依赖关系**：依赖的其他模块或外部服务

**2.3 数据架构**

- **数据模型**：核心数据结构和实体关系
- **数据流向**：数据在系统中的流转路径
- **存储方案**：数据持久化和缓存策略

**3. 功能设计**

**3.1 核心功能**

- **功能点1**：功能描述和实现要点
  - **处理流程**：详细的处理步骤
  - **业务规则**：相关的业务规则和约束
  - **边界条件**：需要处理的特殊情况

- **功能点2**：功能描述和实现要点
  - **处理流程**：详细的处理步骤
  - **业务规则**：相关的业务规则和约束
  - **边界条件**：需要处理的特殊情况

**3.2 算法设计**

- **算法1**：算法名称和用途
  - **算法原理**：算法的基本原理和思路
  - **实现步骤**：详细的实现步骤
  - **复杂度分析**：时间复杂度和空间复杂度

**4. 接口设计**

**4.1 外部接口**

- **接口A**：接口名称和功能
  - **输入参数**：参数名称、类型和说明
  - **输出结果**：返回结果的结构和说明
  - **错误处理**：错误码和异常处理机制

**4.2 配置接口**

- **环境配置**：运行环境的要求和配置项
- **参数配置**：可配置的参数项和默认值
- **扩展配置**：插件和扩展机制的配置方式

**5. 实现指导**

**5.1 技术建议**

- **开发语言**：推荐的开发语言和版本
- **框架选择**：合适的开发框架和工具
- **依赖管理**：第三方依赖的管理策略

**5.2 开发顺序**

- **第一阶段**：建议优先实现的核心功能
- **第二阶段**：可以后续完善的辅助功能
- **第三阶段**：可选的优化和增强功能

**5.3 质量保证**

- **测试策略**：单元测试、集成测试的重点
- **性能要求**：性能指标和优化建议
- **安全考虑**：安全性要求和防护措施

**6. 与原代码功能对齐验证**

- **功能对照表**：原代码功能与新设计方案的映射关系
- **一致性检查**：确保所有功能都被完整覆盖
- **差异说明**：如有必要，说明设计上的改进和优化

---
```

## 实践指导

### 代码分析最佳实践

- **从整体到局部**：先理解整体架构，再深入具体实现
- **功能导向**：关注代码实现的功能，而不是具体的语法细节
- **文档记录**：及时记录分析过程中的关键发现和疑问
- **多角度验证**：从不同角度验证对代码的理解是否正确

### 设计方案构建技巧

- **抽象层次**：保持适当的抽象层次，既不要太具体也不要太抽象
- **结构化表达**：使用清晰的结构和层次来组织设计内容
- **示例说明**：通过具体的示例来说明抽象的设计概念
- **逐步求精**：从高层次设计逐步细化到具体实现细节

### 常见问题和解决方案

#### 问题1：代码过于复杂难以理解

**解决方案**：

- 先绘制代码的模块结构图
- 识别核心流程和辅助流程
- 分阶段进行分析，每次专注于一个模块

#### 问题2：功能点遗漏

**解决方案**：

- 建立功能清单，逐项检查
- 从用户角度思考代码的功能
- 通过测试用例来验证功能完整性

#### 问题3：设计过于依赖具体实现

**解决方案**：

- 使用通用的设计术语
- 关注"做什么"而不是"怎么做"
- 提供多种实现的可能性

## 执行检查清单

### 代码分析阶段

- [ ] 已完整阅读并理解代码的整体架构
- [ ] 已识别主要模块和核心组件
- [ ] 已理解各组件间的调用关系
- [ ] 已提取所有核心业务功能
- [ ] 已分析数据处理流程和算法逻辑
- [ ] 已总结配置参数和环境依赖

### 设计方案构建阶段

- [ ] 已构建语言无关的设计方案
- [ ] 已定义清晰的模块划分和职责边界
- [ ] 已描述核心算法和业务规则
- [ ] 已明确数据流和控制流
- [ ] 设计方案具有可实现性

### 验证确认阶段

- [ ] 设计方案完整覆盖原代码所有功能
- [ ] 提供功能对照表验证完整性
- [ ] 设计方案具有可测试性
- [ ] 提供实现建议和注意事项
- [ ] 使用通用设计术语，避免语言依赖

### 输出质量检查

- [ ] 设计方案结构清晰、层次分明
- [ ] 使用准确、专业的描述语言
- [ ] 提供具体示例说明抽象概念
- [ ] 遵循统一的设计原则和风格
- [ ] 输出格式规范，易于理解和实施
