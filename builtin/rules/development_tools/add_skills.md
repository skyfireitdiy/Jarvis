# 添加技能规范

## 规则简介

本规则用于指导用户将外部技能添加到 Jarvis 系统中。技能可以是本地路径或 git 仓库，添加后将在 `{{ jarvis_data_dir }}/rules/skills.md` 中注册技能信息，供后续使用。

## 你必须遵守的原则

### 1. 路径验证原则

**要求说明：**

- **必须**：在处理任何输入前，先验证其有效性
- **必须**：对于 git url，确认其格式正确
- **必须**：对于本地路径，确认路径存在且可访问
- **禁止**：直接使用未验证的路径或 url

### 2. 技能分析原则

**要求说明：**

- **必须**：分析技能的核心功能和特性
- **必须**：优先读取 README、package.json、setup.py 等文档文件
- **必须**：根据技能复杂度选择合适的分析方法
- **禁止**：仅凭文件名或目录名推断功能

**分析策略：**

- **简单技能**（文件数 < 50，有清晰文档）：直接读取关键文件总结功能
- **复杂技能**（文件数 ≥ 50，文档复杂或缺失）：使用 `task_list_manager` 创建任务列表进行深度分析

### 3. 注册规范原则

**要求说明：**

- **必须**：在 `{{ jarvis_data_dir }}/rules/skills.md` 中注册技能信息
- **必须**：使用统一的注册格式
- **必须**：记录技能名称、功能描述、位置和添加时间
- **禁止**：覆盖已存在的技能注册信息

## 你必须执行的操作

### 操作 1：处理输入

**执行步骤：**

1. 接收用户输入（本地路径或 git url）
2. 判断输入类型：
   - 如果是 git url（以 `http://`、`https://`、`git@` 开头）→ 进入操作 2
   - 如果是本地路径 → 进入操作 3

### 操作 2：处理 git 仓库

**执行步骤：**

1. 检查 `{{ jarvis_data_dir }}/skills` 目录是否存在，不存在则创建
2. 从 git url 中提取仓库名称（例如：`https://github.com/user/repo.git` → `repo`）
3. 执行 git clone 命令：
   ```bash
   git clone <url> {{ jarvis_data_dir }}/skills/<repo_name>
   ```
4. 如果 clone 失败，询问用户处理方法（重试、更换 url 或放弃）
5. 验证 clone 后的目录是否有效

**注意事项：**

- 如果仓库过大，可以使用 shallow clone：`git clone --depth 1 <url>`
- 如果目标目录已存在，询问用户是否覆盖

### 操作 3：验证本地路径

**执行步骤：**

1. 检查路径是否存在
2. 验证路径是否可读
3. 如果路径不存在或不可读，询问用户确认正确的路径

### 操作 4：分析技能功能

**执行步骤：**

1. 读取技能目录中的关键文档文件（按优先级）：
   - `README.md`、`README.rst`、`README.txt`
   - `package.json`（Node.js 项目）
   - `setup.py`、`pyproject.toml`（Python 项目）
   - `Cargo.toml`（Rust 项目）
   - `pom.xml`（Java 项目）
2. 分析文件内容，提取以下信息：
   - 技能名称
   - 核心功能描述
   - 主要特性
   - 适用场景
3. 评估技能复杂度：
   - 统计技能目录中的文件数量
   - 判断是否有清晰的文档
   - 如果技能复杂，使用 `task_list_manager` 创建分析任务

**注意事项：**

- 如果缺少文档文件，基于目录结构和文件名进行推断
- 如果推断困难，使用基础描述："[技能名称] - 功能待完善"

### 操作 5：注册技能信息

**执行步骤：**

1. 检查 `{{ jarvis_data_dir }}/rules/skills.md` 是否存在
2. 如果不存在，创建文件并写入以下头部：

   ```markdown
   # 技能列表

   本文件记录已添加到 Jarvis 系统的技能信息。
   ```

3. 追加技能注册信息（使用以下格式）：

   ```markdown
   ## [技能名称]

   - **功能描述**：[技能的核心功能描述]
   - **位置**：[技能的完整路径]
   - **添加时间**：[YYYY-MM-DD HH:MM:SS]
   ```

4. 确保 Markdown 格式正确

**注意事项：**

- 使用追加模式，不要覆盖已存在的技能信息
- 每个技能注册之间保持一个空行
- 技能位置应使用绝对路径

## 检查清单

在完成任务后，你必须确认：

- [ ] 技能已成功克隆到 `{{ jarvis_data_dir }}/skills/` 目录（如果是 git 仓库）
- [ ] 技能路径已验证有效
- [ ] 技能功能描述已生成
- [ ] 技能信息已注册到 `{{ jarvis_data_dir }}/rules/skills.md`
- [ ] 注册格式符合规范
- [ ] Markdown 语法正确

## 错误处理

### git clone 失败

**处理方法：**

1. 检查网络连接
2. 确认 git url 格式正确
3. 询问用户是否需要：
   - 重试 clone
   - 更换 git url
   - 放弃添加此技能

### 路径不存在

**处理方法：**

1. 询问用户确认正确的路径
2. 提示检查路径拼写
3. 提供重新输入的机会

### 分析失败

**处理方法：**

1. 提供基础描述选项
2. 询问用户是否手动提供功能描述
3. 使用目录名作为技能名称，功能描述为"待完善"

## 相关资源

- 参考规则：`{{ rule_file_dir }}/../tool_config/add_rule.md`
