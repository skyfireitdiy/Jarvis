# 9. 附录

## 9.1 完整配置项列表

以下是 `~/.jarvis/config.yaml` 中所有可配置的参数及其说明。

| 变量名称                             | 默认值   | 说明                                                                                                                                                                                                                                                                                                                                     |
| ------------------------------------ | -------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `ENV`                                | `{}`     | 环境变量配置，用于存放API Keys等敏感信息，如 `YUANBAO_COOKIES`。                                                                                                                                                                                                                                                                         |
| `llms`                               | `{}`     | 可复用的LLM配置定义，可以在 `llm_groups` 中通过引用名称来使用。每个配置包含 `platform`（平台名称）、`model`（模型名称）、`max_input_token_count`（最大输入token数量）、`llm_config`（LLM特定的配置参数，如 API key 等）。                                                                                                                |
| `llm_groups`                         | `[]`     | 预定义的LLM配置组列表。每个组可以通过 `normal_llm`、`cheap_llm`、`smart_llm` 引用 `llms` 中定义的配置，也可以直接指定 `platform`、`model`、`max_input_token_count` 等字段（已弃用，建议使用引用方式）。每个组还可以包含一个可选的 `ENV` 字典用于覆盖当前会话的环境变量。                                                                   |
| `llm_group`                          | `""`     | 选择要激活的LLM组名称。                                                                                                                                                                                                                                                                                                                  |
| `max_input_token_count`              | `32000`  | 输入给模型的最大token数量 (可被模型组覆盖)。                                                                                                                                                                                                                                                                                             |
| `platform`                           | `openai` | 默认AI平台 (可被模型组覆盖)。                                                                                                                                                                                                                                                                                                            |
| `model`                              | `gpt-5`  | 默认模型 (可被模型组覆盖)。                                                                                                                                                                                                                                                                                                              |
| `cheap_platform`                     | `""`     | 廉价操作的平台名称。如未配置，则使用 `platform` 的值 (可被模型组覆盖)。                                                                                                                                                                                                                                                                 |
| `cheap_model`                        | `""`     | 廉价操作的模型名称。如未配置，则使用 `model` 的值 (可被模型组覆盖)。                                                                                                                                                                                                                                                                    |
| `cheap_max_input_token_count`        | `0`      | 廉价模型允许的最大输入token数量。如未配置（值为0），则使用 `max_input_token_count` 的值 (可被模型组覆盖)。                                                                                                                                                                                                                              |
| `smart_platform`                     | `""`     | 智能操作的平台名称。如未配置，则使用 `platform` 的值 (可被模型组覆盖)。                                                                                                                                                                                                                                                                 |
| `smart_model`                        | `""`     | 智能操作的模型名称。如未配置，则使用 `model` 的值 (可被模型组覆盖)。                                                                                                                                                                                                                                                                    |
| `smart_max_input_token_count`        | `0`      | 智能模型允许的最大输入token数量。如未配置（值为0），则使用 `max_input_token_count` 的值 (可被模型组覆盖)。                                                                                                                                                                                                                              |

以下是一个使用引用方式的 `llm_groups` 配置示例：

```yaml
llms:
  claude-4-5:
    platform: openai
    model: claude-opus-4-5-20251101
    max_input_token_count: 200000
    llm_config:
      openai_api_key: sk-xxx
      openai_api_base: https://api.openai.com/v1
  tongyi-normal:
    platform: tongyi
    model: Normal
    max_input_token_count: 128000
    llm_config:
      tongyi_cookies: your_cookies_here

llm_groups:
  - claude:
      normal_llm: claude-4-5
      cheap_llm: tongyi-normal
  - tongyi:
      normal_llm: tongyi-normal

llm_group: claude
```

当设置 `llm_group: claude` 时，Jarvis将使用 `claude-4-5` 作为常规模型，`tongyi-normal` 作为廉价模型。

以下是一个使用引用方式的 `rag_groups` 配置示例：

```yaml
embeddings:
  code-embedding:
    embedding_model: Qwen/Qwen3-Embedding-0.6B
    embedding_type: LocalEmbeddingModel
    embedding_max_length: 512
  doc-embedding:
    embedding_model: BAAI/bge-m3
    embedding_type: LocalEmbeddingModel
    embedding_max_length: 512
    embedding_config:
      # 如果使用在线模型，可以在这里配置 API key
      # openai_api_key: sk-xxx
      # cohere_api_key: xxx

rerankers:
  doc-reranker:
    rerank_model: BAAI/bge-reranker-v2-m3
    reranker_type: LocalReranker
    reranker_max_length: 512
    reranker_config:
      # 如果使用在线模型，可以在这里配置 API key
      # cohere_api_key: xxx

rag_groups:
  - code:
      embedding: code-embedding
      use_bm25: false
      use_rerank: false
  - doc:
      embedding: doc-embedding
      reranker: doc-reranker
      use_bm25: true
      use_rerank: true

rag_group: code
```

当设置 `rag_group: code` 时，Jarvis将使用 `code-embedding` 作为嵌入模型，不使用重排。

| 变量名称                                | 默认值                                                                                                                                                                                                                             | 说明                                                                                                                                                                                                               |
| --------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `web_search_platform`                  | `""`                                                                                                                                                                                                                               | Web搜索使用的平台名称。如未配置，使用默认模型选择流程。                                                                                                                                                            |
| `web_search_model`                     | `""`                                                                                                                                                                                                                               | Web搜索使用的模型名称。如未配置，使用默认模型选择流程。                                                                                                                                                            |
| `execute_tool_confirm`                 | `false`                                                                                                                                                                                                                            | 在执行任何工具前是否需要用户手动确认。                                                                                                                                                                             |
| `tool_load_dirs`                        | `[]`                                                                                                                                                                                                                               | 额外的工具加载目录列表。                                                                                                                                                                                           |
| `after_tool_call_cb_dirs`               | `[]`                                                                                                                                                                                                                               | 工具调用后回调函数实现目录列表（扫描 .py 文件并按约定动态注册回调；支持 ~ 与环境变量展开）。                                                                                                                       |
| `methodology_dirs`                      | `[]`                                                                                                                                                                                                                               | 方法论加载目录列表（支持 ~ 与环境变量展开）。                                                                                                                                                                      |
| `agent_definition_dirs`                 | `[]`                                                                                                                                                                                                                               | agent 定义加载目录列表（支持 ~ 与环境变量展开）。                                                                                                                                                                  |
| `multi_agent_dirs`                      | `[]`                                                                                                                                                                                                                               | multi_agent 加载目录列表（支持 ~ 与环境变量展开）。                                                                                                                                                                |
| `roles_dirs`                            | `[]`                                                                                                                                                                                                                               | roles 加载目录列表（支持 ~ 与环境变量展开）。                                                                                                                                                                      |
| `central_methodology_repo`               | `""`                                                                                                                                                                                                                               | 中心方法论仓库路径或Git仓库地址。支持本地目录（含git子路径）：若为本地目录将直接加入方法论加载路径；若为Git URL则会克隆到数据目录后加载。                                                                          |
| `central_tool_repo`                     | `""`                                                                                                                                                                                                                               | 中心工具仓库路径或Git仓库地址。支持本地目录（含git子路径）：若为本地目录将直接加载其中的工具；若为Git URL则会克隆到数据目录并加载。                                                                                |
| `tool_groups`                           | `[]`                                                                                                                                                                                                                               | 预定义的工具配置组列表，每个配置组可包含`use`和`dont_use`两个可选数组。                                                                                                                                            |
| `tool_group`                            | `""`                                                                                                                                                                                                                               | 选择要激活的工具配置组名称。                                                                                                                                                                                       |
| `tool_filter_threshold`                 | `30`                                                                                                                                                                                                                               | AI 工具筛选阈值：当可用工具数量超过此值时，首次运行会触发 AI 自动筛选，仅保留与当前任务最相关的工具，以降低干扰并提升效率。                                                                                        |
| `script_execution_timeout`              | `300`                                                                                                                                                                                                                              | 脚本执行的超时时间（秒），仅在非交互模式下生效。                                                                                                                                                                   |
| `confirm_before_apply_patch`            | `false`                                                                                                                                                                                                                            | 在应用文件修改（补丁）前是否需要用户手动确认。                                                                                                                                                                     |
| `pretty_output`                          | `true`                                                                                                                                                                                                                             | 是否启用更美观的终端格式化输出（默认启用；Windows 下强制关闭；可能与某些终端不兼容）。                                                                                                                             |
| `print_error_traceback`                  | `false`                                                                                                                                                                                                                            | 是否在错误输出时自动打印回溯调用链。默认关闭；如需全局启用，请设置为 `true`；也可在调用 PrettyOutput.print 时通过 `traceback=True` 临时开启。                                                                      |
| `git_commit_prompt`                     | `""`                                                                                                                                                                                                                               | 用于 `jgc` 的自定义git提交信息生成提示模板。                                                                                                                                                                       |
| `print_prompt`                           | `false`                                                                                                                                                                                                                            | 是否在终端打印发送给LLM的完整提示（Prompt），用于调试。                                                                                                                                                            |
| `use_methodology`                       | `true`                                                                                                                                                                                                                             | 是否启用方法论功能，让AI先思考策略再执行。                                                                                                                                                                         |
| `use_analysis`                          | `true`                                                                                                                                                                                                                             | 是否启用任务分析功能，让AI先分解任务再执行。                                                                                                                                                                       |
| `enable_static_analysis`                | `true`                                                                                                                                                                                                                             | 是否在代码任务中启用静态代码分析。                                                                                                                                                                                 |
| `enable_build_validation`                | `true`                                                                                                                                                                                                                             | 是否启用构建验证。在代码编辑后自动验证代码能否成功编译/构建，确保编辑不会破坏项目构建。支持多种构建系统（Python、Node.js、Rust、Java、Go、C/C++等）。                                                              |
| `build_validation_timeout`              | `30`                                                                                                                                                                                                                               | 构建验证的超时时间（秒）。当构建验证执行时间超过此值时，将终止验证并报告超时。                                                                                                                                     |
| `enable_impact_analysis`                | `true`                                                                                                                                                                                                                             | 是否启用编辑影响范围分析。分析代码编辑的影响范围，识别可能受影响的文件、函数、测试等，帮助评估编辑风险。                                                                                                           |
| `data_path`                             | `~/.jarvis`                                                                                                                                                                                                                        | Jarvis数据存储目录路径。                                                                                                                                                                                           |
| `SHELL`                                 | `/bin/bash`                                                                                                                                                                                                                        | 系统Shell路径，用于获取当前使用的shell类型。                                                                                                                                                                       |
| `embeddings`                            | `{}`                                                                                                                                                                                                                               | 可复用的嵌入模型配置定义，可以在 `rag_groups` 中通过引用名称来使用。每个配置包含 `embedding_model`（嵌入模型名称）、`embedding_type`（嵌入模型类型）、`embedding_max_length`（最大输入长度）、`embedding_config`（额外配置参数）。 |
| `rerankers`                             | `{}`                                                                                                                                                                                                                               | 可复用的重排模型配置定义，可以在 `rag_groups` 中通过引用名称来使用。每个配置包含 `rerank_model`（重排模型名称）、`reranker_type`（重排模型类型）、`reranker_max_length`（最大输入长度）、`reranker_config`（额外配置参数）。 |
| `rag_groups`                            | `[{"text": {"embedding_model": "BAAI/bge-m3", "embedding_type": "LocalEmbeddingModel", "embedding_max_length": 512, "embedding_config": {}, "rerank_model": "BAAI/bge-reranker-v2-m3", "reranker_type": "LocalReranker", "reranker_max_length": 512, "reranker_config": {}, "use_bm25": true, "use_rerank": true}}, {"code": {"embedding_model": "Qodo/Qodo-Embed-1-1.5B", "embedding_type": "LocalEmbeddingModel", "embedding_max_length": 512, "embedding_config": {}, "use_bm25": false, "use_rerank": false}}]` | 预定义的RAG配置组列表。每个配置组可以通过 `embedding` 和 `reranker` 引用 `embeddings` 和 `rerankers` 中定义的配置，也可以直接指定 `embedding_model`、`embedding_type` 等字段（已弃用，建议使用引用方式）。每个配置组可包含 `embedding_model`（嵌入模型名称）、`embedding_type`（嵌入模型类型，如 'LocalEmbeddingModel', 'OpenAIEmbeddingModel' 等）、`embedding_max_length`（嵌入模型最大输入长度，token数）、`embedding_config`（嵌入模型额外配置）、`rerank_model`（重排模型名称）、`reranker_type`（重排模型类型，如 'LocalReranker', 'CohereReranker' 等）、`reranker_max_length`（重排模型最大输入长度，token数）、`reranker_config`（重排模型额外配置）、`use_bm25`（是否使用BM25）、`use_rerank`（是否使用重排）等配置项。 |
| `rag_group`                             | `""`                                                                                                                                                                                                                               | 选择要激活的RAG配置组名称。                                                                                                                                                                                        |
| `rag`                                   | `{"embedding_model": "BAAI/bge-m3", "embedding_type": "LocalEmbeddingModel", "embedding_max_length": 512, "embedding_config": {}, "rerank_model": "BAAI/bge-reranker-v2-m3", "reranker_type": "LocalReranker", "reranker_max_length": 512, "reranker_config": {}, "use_bm25": true, "use_rerank": true}`                                                                                                              | RAG框架的顶层配置，会覆盖组配置。可配置项包括：`embedding_model`（嵌入模型名称）、`embedding_type`（嵌入模型类型，默认为 'LocalEmbeddingModel'）、`embedding_max_length`（嵌入模型最大输入长度，token数，默认512）、`embedding_config`（嵌入模型额外配置，字典类型，用于传递API密钥等参数）、`rerank_model`（重排模型名称）、`reranker_type`（重排模型类型，默认为 'LocalReranker'）、`reranker_max_length`（重排模型最大输入长度，token数，默认512）、`reranker_config`（重排模型额外配置，字典类型）、`use_bm25`（是否使用BM25，默认true）、`use_rerank`（是否使用重排，默认true）。支持的嵌入模型类型：`LocalEmbeddingModel`（本地HuggingFace模型，默认）、`OpenAIEmbeddingModel`（OpenAI API）、`CohereEmbeddingModel`（Cohere API）、`EdgeFnEmbeddingModel`（EdgeFn API）等。支持的重排模型类型：`LocalReranker`（本地CrossEncoder模型，默认）、`CohereReranker`（Cohere API）、`JinaReranker`（Jina API）、`EdgeFnReranker`（EdgeFn API）等。 |
| `replace_map`                           | `{}`                                                                                                                                                                                                                               | 自定义快捷指令（命令替换）的映射。                                                                                                                                                                                 |
| `mcp`                                   | `[]`                                                                                                                                                                                                                               | MCP (Model Communication Protocol) 服务的配置列表。                                                                                                                                                                |
| `force_save_memory`                     | `false`                                                                                                                                                                                                                            | 在上下文历史被清理前或任务完成时，强制提示用户保存记忆。                                                                                                                                                           |
| `enable_git_jca_switch`                 | `true`                                                                                                                                                                                                                             | 在检测到当前目录为 Git 仓库时，是否提示并可自动切换到代码开发模式（jca）。                                                                                                                                         |
| `enable_startup_config_selector`       | `true`                                                                                                                                                                                                                             | 在进入默认通用代理前，是否列出可用配置（agent/multi_agent/roles）供选择。                                                                                                                                          |
| `immediate_abort`                       | `false`                                                                                                                                                                                                                            | 是否启用立即中断：当检测到用户中断信号（如 Ctrl+C）时，在对话输出流的每次迭代中立即返回当前已生成内容并停止继续输出；关闭时不中途打断输出。                                                                        |
| `save_session_history`                  | `false`                                                                                                                                                                                                                            | 是否保存会话记录。                                                                                                                                                                                                 |
| `skip_predefined_tasks`                 | `false`                                                                                                                                                                                                                            | 是否跳过预定义任务加载（不读取 pre-command 列表）。启用后不展示预定义任务选择。                                                                                                                                    |
| `addon_prompt_threshold`                | `1024`                                                                                                                                                                                                                             | 附加提示的触发阈值（字符数）。当消息长度超过此值时，会自动添加默认的附加提示。                                                                                                                                     |
| `enable_intent_recognition`            | `true`                                                                                                                                                                                                                             | 是否启用意图识别功能。用于智能上下文推荐中的LLM意图提取和语义分析。默认开启。                                                                                                                                      |
| `enable_memory_organizer`                | `false`                                                                                                                                                                                                                            | 是否启用自动记忆整理功能。在任务完成后自动检测记忆库状态，当记忆数量超过200条且存在重叠时提示用户整理。默认关闭。                                                                                                  |
| `conversation_turn_threshold`            | `50`                                                                                                                                                                                                                               | 对话轮次阈值，用于触发总结。当对话轮次超过此值时，系统会自动触发对话总结，清理历史记录并生成摘要。                                                                                                                 |
| `diff_visualization_mode`               | `side_by_side`                                                                                                                                                                                                                     | Diff可视化模式。可选值：`side_by_side`（左右分栏对比显示，默认）、`unified`（统一diff格式）、`syntax`（语法高亮模式）、`compact`（紧凑模式）。                                                                     |
| `diff_show_line_numbers`                | `true`                                                                                                                                                                                                                             | 是否在 diff 中显示行号。                                                                                                                                                                                           |
| `diff_large_file_threshold`             | `300`                                                                                                                                                                                                                              | 大文件阈值（超过此行数只显示统计）。                                                                                                                                                                               |

## 9.2 许可证信息

Jarvis 项目采用 **MIT 许可证**。

MIT 许可证是一种非常宽松的开源许可证，它授予您广泛的权利，包括：

- **商业使用**: 您可以将 Jarvis 用于商业目的。
- **分发**: 您可以分发 Jarvis 的原始或修改版本。
- **修改**: 您可以修改 Jarvis 的源代码。
- **私用**: 您可以将 Jarvis 用于个人项目。

唯一的限制是，您必须在您的软件副本中包含原始的版权和许可声明。该许可证不提供任何形式的担保。

完整的许可证文本可以在项目根目录的 `LICENSE` 文件中找到。
